var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},mycore;!function(a){!function(a){!function(b){!function(b){var c=function(a){function b(b,c,d,e,f,g,h){a.call(this,c,d,e,f,g,h),this.smLinkMap=b,this.altoPresent=h}return __extends(b,a),b}(a.model.StructureModel);b.MetsStructureModel=c}(b.mets||(b.mets={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(b){!function(c){var d=function(){function c(a,b){this.metsDocument=a,this.tilePathBuilder=b,this.hrefResolverElement=document.createElement("a")}return c.prototype.processMets=function(){var a=this,c=this.getFiles("IVIEW2");0==c.length&&(c=this.getFiles("MASTER")),this._idFileMap=this.getIdFileMap(c);var d=new MyCoReMap;return this.getGroups().map(function(a){return a.getAttribute("USE")}).map(function(a){return a.toUpperCase()}).filter(function(a){return"MASTER"!=a}).forEach(function(b){var c=a.getFiles(b);d.set(b,c),a._idFileMap.mergeIn(a.getIdFileMap(c))}),this._chapterIdMap=new MyCoReMap,this._idPhysicalFileMap=this.getIdPhysicalFileMap(),this._smLinkMap=new MyCoReMap,this._chapterImageMap=new MyCoReMap,this._imageChapterMap=new MyCoReMap,this._improvisationMap=new MyCoReMap,this._metsChapter=this.processChapter(null,this.getFirstElementChild(this.getStructMap("LOGICAL"))),this._imageHrefImageMap=new MyCoReMap,this._imageList=[],this._idImageMap=new MyCoReMap,this.processImages(),this._structureModel=new b.mets.MetsStructureModel(this._smLinkMap,this._metsChapter,this._imageList,this._chapterImageMap,this._imageChapterMap,this._imageHrefImageMap,d.has("ALTO")&&d.get("ALTO").length>0),this._structureModel},c.prototype.getStructMap=function(a){var b="//mets:structMap[@TYPE='"+a+"']";return singleSelectShim(this.metsDocument,b,c.NS_MAP)},c.prototype.getGroups=function(){return getNodesShim(this.metsDocument,"//mets:fileSec//mets:fileGrp",this.metsDocument.documentElement,c.NS_MAP,4,null)},c.prototype.getFiles=function(a){var b="//mets:fileSec//mets:fileGrp[@USE='"+a+"']",d=singleSelectShim(this.metsDocument,b,c.NS_MAP),e=[];return null!=d&&(e=XMLUtil.nodeListToNodeArray(d.childNodes)),e},c.prototype.getStructLinks=function(){var a="//mets:structLink",b=singleSelectShim(this.metsDocument,a,c.NS_MAP),d=[];return XMLUtil.iterateChildNodes(b,function(a){(a instanceof Element||"getAttribute"in a)&&d.push(a)}),d},c.prototype.processChapter=function(b,c){if("mets:mptr"!=c.nodeName.toString()){var d=new a.model.StructureChapter(b,c.getAttribute("TYPE"),c.getAttribute("ID"),c.getAttribute("LABEL")),e=c.childNodes;this._chapterIdMap.set(d.id,d);for(var f=0;f<e.length;f++){var g=e[f];(g instanceof Element||"getAttribute"in g)&&(-1!=g.nodeName.indexOf("fptr")?this.processFPTR(d,g):-1!=g.nodeName.indexOf("div")&&d.chapter.push(this.processChapter(d,g)))}return d}},c.prototype.processFPTR=function(a,b){var c=this,d=this.getFirstElementChild(b);d.nodeName.indexOf("seq")?XMLUtil.iterateChildNodes(d,function(b){(b instanceof Element||"getAttribute"in b)&&c.parseArea(a,b)}):d.nodeName.indexOf("area")&&this.parseArea(a,d)},c.prototype.parseArea=function(a,b){var c;a.additional.has("blocklist")?c=a.additional.get("blocklist"):(c=[],a.additional.set("blocklist",c));var d=b.getAttribute("FILEID");if(null==d)throw"@FILEID of mets:area is required but not set!";var e=this.getAttributeNs(this.getFirstElementChild(this._idFileMap.get(d)),"xlink","href");if(null==e)throw"couldn't find href of @FILEID in mets:area! "+d;var f={fileId:e};"IDREF"==b.getAttribute("BETYPE")?(f.fromId=b.getAttribute("BEGIN"),f.toId=b.getAttribute("END")):console.warn("mets:area/@FILEID='"+e+"' has no BETYPE attribute"),c.push(f)},c.prototype.getIdFileMap=function(a){var b=new MyCoReMap;return a.forEach(function(a,c){if(a instanceof Element||"getAttribute"in a){var d=a;b.set(d.getAttribute("ID"),d)}}),b},c.prototype.getIdPhysicalFileMap=function(){for(var a=new MyCoReMap,b=this.getStructMap("PHYSICAL"),c=this.getFirstElementChild(b).childNodes,d=0;d<c.length;d++){var e=c[d];"getAttribute"in e&&a.set(e.getAttribute("ID"),e)}return a},c.prototype.getFirstElementChild=function(a){return"firstElementChild"in a?a.firstElementChild:a.firstChild},c.prototype.getAttributeNs=function(a,b,d){return"getAttributeNS"in a?a.getAttributeNS(c.NS_MAP.get(b),d):a.getAttribute(b+":"+d)},c.prototype.processImages=function(){var a=this,b=1;this._idPhysicalFileMap.forEach(function(c,d){var e=a._idPhysicalFileMap.get(c),f=a.parseFile(e,b++);null!=f&&(a._imageList.push(f),a._idImageMap.set(c,f))}),this._imageList=this._imageList.sort(function(a,b){return a.order-b.order}),this.makeLinks(),this._imageList=this._imageList.filter(function(b){return a._imageChapterMap.has(b.id)}),this._imageList.forEach(function(b,c){b.order=c+1,a._imageHrefImageMap.set(b.href,b)})},c.prototype.makeLinks=function(){var a=this;this.getStructLinks().forEach(function(b){var c=a.getAttributeNs(b,"xlink","from"),d=a.getAttributeNs(b,"xlink","to");a.makeLink(a._chapterIdMap.get(c),a._idImageMap.get(d))})},c.prototype.makeLink=function(a,b){null==a.parent||this._chapterImageMap.has(a.parent.id)||(this._improvisationMap.set(a.parent.id,!0),this._chapterImageMap.set(a.parent.id,b)),(!this._chapterImageMap.has(a.id)||this._imageList.indexOf(this._chapterImageMap.get(a.id))>this._imageList.indexOf(b)||this._improvisationMap.has(a.id)&&this._improvisationMap.get(a.id))&&(this._chapterImageMap.set(a.id,b),this._improvisationMap.set(a.id,!1)),this._imageChapterMap.has(b.id)||this._imageChapterMap.set(b.id,a),this._smLinkMap.has(a.id)||this._smLinkMap.set(a.id,[]),this._smLinkMap.get(a.id).push(b.href)},c.prototype.extractTranslationLanguage=function(a){return a.split("/")[1].split(".")[1]},c.prototype.parseFile=function(b,d){var e=this,f=b.getAttribute("TYPE"),g=b.getAttribute("ID"),h=parseInt(b.getAttribute("ORDER")||""+d,10),i=b.getAttribute("ORDERLABEL"),j=b.getAttribute("CONTENTIDS"),k=new MyCoReMap,l=null,m=null;this.hrefResolverElement.href="./";var n=this.hrefResolverElement.href;if(XMLUtil.iterateChildNodes(b,function(a){if(a instanceof Element||"getAttribute"in a){var b=a,d=b.getAttribute("FILEID"),f=e._idFileMap.get(d),g=e.getAttributeNs(e.getFirstElementChild(f),"xlink","href"),h=f.getAttribute("MIMETYPE");e.hrefResolverElement.href=g,g=e.hrefResolverElement.href.substr(n.length);var i=f.parentNode.getAttribute("USE");"MASTER"===i||"IVIEW2"===i?(l=g,m=h):"ALTO"===i?k.set(c.ALTO_TEXT,g):0==i.indexOf("TEI.")?k.set(i,g):console.warn("Unknown File Group : "+i)}}),null===l)return console.warn("Unable to find MASTER|IVIEW2 file for "+g),null;if(l.indexOf("http:")+l.indexOf("file:")+l.indexOf("urn:")!==-3){var o=document.createElement("a");o.href=l,l=o.pathname}return new a.model.StructureImage(f,g,h,i,l,m,function(a){a(e.tilePathBuilder(l))},k,j)},c.METS_NAMESPACE_URI="http://www.loc.gov/METS/",c.XLINK_NAMESPACE_URI="http://www.w3.org/1999/xlink",c.ALTO_TEXT="AltoHref",c.TEI_TRANSCRIPTION="TeiTranscriptionHref",c.TEI_TRANSLATION="TeiTranslationHref",c.NS_RESOLVER={lookupNamespaceURI:function(a){return"mets"==a?c.METS_NAMESPACE_URI:null}},c.NS_MAP=function(){var a=new MyCoReMap;return a.set("mets",c.METS_NAMESPACE_URI),a.set("xlink",c.XLINK_NAMESPACE_URI),a}(),c}();c.MetsStructureBuilder=d}(b.mets||(b.mets={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function b(){}return b.loadModel=function(b,c){var d=new ViewerPromise,e={url:b,success:function(b){var e=new a.MetsStructureBuilder(b,c);d.resolve({model:e.processMets(),document:b})},error:function(a,b,c){d.reject(c)}};return jQuery.ajax(e),d},b}();a.IviewMetsProvider=b}(a.mets||(a.mets={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(a){function b(c,d){a.call(this,c,b.TYPE),this.mets=d}return __extends(b,a),b.TYPE="MetsLoadedEvent",b}(a.MyCoReImageViewerEvent);a.MetsLoadedEvent=b}(a.events||(a.events={}))}(a.components||(a.components={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a,b,c){this.file=a,this.type=b,this.pageOrder=c}return a}();a.AltoChange=b;var c=function(a){function b(c,d,e,f,g,h,i,j){a.call(this,c,b.TYPE,j),this.hpos=d,this.vpos=e,this.width=f,this.height=g,this.from=h,this.to=i}return __extends(b,a),b.TYPE="AltoWordChange",b}(b);a.AltoWordChange=c}(a.alto||(a.alto={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(b){!function(b){var c=a.viewer.components.events.ShowContentEvent,d=function(d){function e(e,f){var g=this;d.call(this),this._settings=e,this.container=f,this.errorSync=Utils.synchronize([function(a){return null!=a.lm&&a.error}],function(b){new a.viewer.widgets.modal.ViewerErrorModal(g._settings.mobile,b.lm.getTranslation("noMetsShort"),b.lm.getFormatedTranslation("noMets","<a href='mailto:"+g._settings.adminMail+"'>"+g._settings.adminMail+"</a>"),g._settings.webApplicationBaseURL+"/modules/iview2/img/sad-emotion-egg.jpg",g.container[0]).show(),b.trigger(new c(g,jQuery(),a.viewer.widgets.layout.IviewBorderLayout.DIRECTION_WEST,0))}),this.metsAndLanguageSync=Utils.synchronize([function(a){return null!=a.mm},function(a){return null!=a.lm}],function(a){g.metsLoaded(g.mm.model),g.trigger(new b.events.MetsLoadedEvent(g,g.mm))}),this.error=!1,this.lm=null,this.mm=null}return __extends(e,d),e.prototype.init=function(){var c=this,d=this._settings;if("mets"==d.doctype){"/"!=d.imageXmlPath.charAt(d.imageXmlPath.length-1)&&(d.imageXmlPath=d.imageXmlPath+"/"),"/"!=d.tileProviderPath.charAt(d.tileProviderPath.length-1)&&(d.tileProviderPath=d.tileProviderPath+"/");var e=this;this._metsLoaded=!1;var f=function(a){return e._settings.tileProviderPath.split(",")[0]+e._settings.derivate+"/"+a+"/0/0/0.jpg"},g=a.viewer.widgets.mets.IviewMetsProvider.loadModel(this._settings.metsURL,f);g.then(function(a){var d=a.model;if(c.trigger(new b.events.WaitForEvent(c,b.events.LanguageModelLoadedEvent.TYPE)),null==d)return c.error=!0,void c.errorSync(c);c.mm=a,c.metsAndLanguageSync(c)}),g.onreject(function(){c.trigger(new b.events.WaitForEvent(c,b.events.LanguageModelLoadedEvent.TYPE)),c.error=!0,c.errorSync(c)}),this.trigger(new b.events.ComponentInitializedEvent(this))}},e.prototype.postProcessChapter=function(a){var b=this;if((null==a.label||void 0===a.label||""==a.label)&&null!=a.type&&void 0!==a.type&&""!=a.type){var c=this.buildTranslationKey(a.type||"");this.lm.hasTranslation(c)&&(a._label=this.lm.getTranslation(c))}a.chapter.forEach(function(a){b.postProcessChapter(a)})},e.prototype.buildTranslationKey=function(a){return"dfgStructureSet."+a.replace("- ","")},e.prototype.metsLoaded=function(a){this.postProcessChapter(a._rootChapter);var c=new b.events.StructureModelLoadedEvent(this,a);this.trigger(c),this._metsLoaded=!0,this._eventToTrigger=c;var d=this._settings.filePath,e=null;a._imageList.forEach(function(a){"/"+a.href!=d&&a.href!=d||(e=a)}),null!=e&&this.trigger(new b.events.ImageSelectedEvent(this,e))},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){return[b.events.LanguageModelLoadedEvent.TYPE]},enumerable:!0,configurable:!0}),e.prototype.handle=function(a){if(a.type==b.events.LanguageModelLoadedEvent.TYPE){var c=a;this.lm=c.languageModel,this.errorSync(this),this.metsAndLanguageSync(this)}},e}(b.ViewerComponent);b.MyCoReMetsComponent=d}(b.components||(b.components={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReMetsComponent);var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.getInformation=function(b,c,d,e){void 0===e&&(e=function(a){});var f={url:b+c+"/imageinfo.xml",async:!0,success:function(b){var e=a.proccessXML(b,c);d(e)},error:function(a,b,c){e(c)}};jQuery.ajax(f)},a.proccessXML=function(a,b){var d=jQuery(a.childNodes[0]);return new c(d.attr("derivate"),b,parseInt(d.attr("tiles")),parseInt(d.attr("width")),parseInt(d.attr("height")),parseInt(d.attr("zoomLevel")))},a}();a.XMLImageInformationProvider=b;var c=function(){function a(a,b,c,d,e,f){this._derivate=a,this._path=b,this._tiles=c,this._width=d,this._height=e,this._zoomlevel=f}return Object.defineProperty(a.prototype,"derivate",{get:function(){return this._derivate},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tiles",{get:function(){return this._tiles},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"zoomlevel",{get:function(){return this._zoomlevel},enumerable:!0,configurable:!0}),a}();a.XMLImageInformation=c}(a.image||(a.image={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a,b,c,d){this.id=a,this._width=b,this._height=c,this._tiles=new MyCoReMap,this._loadingTiles=new MyCoReMap,this._backBuffer=document.createElement("canvas"),this._backBufferArea=null,this._backBufferAreaZoom=null,this._previewBackBuffer=document.createElement("canvas"),this._previewBackBufferArea=null,this._previewBackBufferAreaZoom=null,this._imgPreviewLoaded=!1,this._imgNotPreviewLoaded=!1,this.htmlContent=new ViewerProperty(this,"htmlContent"),this._tilePath=d,this.loadTile(new Position3D(0,0,0))}return Object.defineProperty(a.prototype,"size",{get:function(){return new Size2D(this._width,this._height)},enumerable:!0,configurable:!0}),a.prototype.draw=function(b,c,d,e){(c.pos.x<0||c.pos.y<0)&&(c=new Rect(c.pos.max(0,0),c.size));var f=Math.min(this.getZoomLevel(d),this.maxZoomLevel()),g=this.scaleForLevel(f),h=d/g,i=a.TILE_SIZE/g,j=Math.floor(c.pos.x/i),k=Math.floor(c.pos.y/i),l=Math.ceil(Math.min(c.pos.x+c.size.width,this.size.width)/i),m=Math.ceil(Math.min(c.pos.y+c.size.height,this.size.height)/i);this._updateBackbuffer(j,k,l,m,f,e),b.save();var n=(j*i-c.pos.x)*d,o=(k*i-c.pos.y)*d;b.translate(n,o),b.scale(h,h),e?b.drawImage(this._previewBackBuffer,0,0):b.drawImage(this._backBuffer,0,0),b.restore()},a.prototype.getHTMLContent=function(){return this.htmlContent},a.prototype.updateHTML=function(){void 0!==this.refreshCallback&&null!=this.refreshCallback&&this.refreshCallback()},a.prototype.clear=function(){this._abortLoadingTiles(),this._backBuffer.width=1,this._backBuffer.height=1,this._backBufferAreaZoom=null;var a=new Position3D(0,0,0),b=this._tiles.has(a);if(b)var c=this._tiles.get(a);this._tiles.clear(),b&&this._tiles.set(a,c),this._loadingTiles.clear()},a.prototype._updateBackbuffer=function(a,b,c,d,e,f){var g=new Rect(new Position2D(a,b),new Size2D(c-a,d-b));if(f){if(null!==this._previewBackBufferArea&&!this._imgPreviewLoaded&&this._previewBackBufferArea.equals(g)&&e==this._previewBackBufferAreaZoom)return;this._previewBackBuffer.width=256*g.size.width,this._previewBackBuffer.height=256*g.size.height,this._drawToBackbuffer(a,b,c,d,e,!0),this._previewBackBufferArea=g,this._previewBackBufferAreaZoom=e,this._imgPreviewLoaded=!1}else{if(null!==this._backBufferArea&&!this._imgNotPreviewLoaded&&this._backBufferArea.equals(g)&&e==this._backBufferAreaZoom)return;this._abortLoadingTiles(),this._backBuffer.width=256*g.size.width,this._backBuffer.height=256*g.size.height,this._drawToBackbuffer(a,b,c,d,e,!1),this._backBufferArea=g,this._backBufferAreaZoom=e,this._imgNotPreviewLoaded=!1}},a.prototype._abortLoadingTiles=function(){this._loadingTiles.forEach(function(b,c){c.onerror=a.EMPTY_FUNCTION,c.onload=a.EMPTY_FUNCTION,c.src="#"}),this._loadingTiles.clear()},a.prototype._drawToBackbuffer=function(a,b,c,d,e,f){var g;g=f?this._previewBackBuffer.getContext("2d"):this._backBuffer.getContext("2d");for(var h=a;h<c;h++)for(var i=b;i<d;i++){var j=new Position3D(h,i,e),k=this.loadTile(j),l=256*(h-a),m=256*(i-b);if(null!=k)g.drawImage(k,Math.floor(l),m,k.naturalWidth,k.naturalHeight);else{var n=this.getPreview(j);null!=n&&this.drawPreview(g,new Position2D(l,m),n)}}},a.prototype.drawPreview=function(a,b,c){c.areaToDraw.size.width=Math.min(c.areaToDraw.pos.x+c.areaToDraw.size.width,c.tile.naturalWidth)-c.areaToDraw.pos.x,c.areaToDraw.size.height=Math.min(c.areaToDraw.pos.y+c.areaToDraw.size.height,c.tile.naturalHeight)-c.areaToDraw.pos.y,a.drawImage(c.tile,c.areaToDraw.pos.x,c.areaToDraw.pos.y,c.areaToDraw.size.width,c.areaToDraw.size.height,b.x,b.y,c.areaToDraw.size.width*c.scale,c.areaToDraw.size.height*c.scale)},a.prototype.loadTile=function(a){var b=this;return this._tiles.has(a)?this._tiles.get(a):(this._loadingTiles.has(a)||this._loadTile(a,function(c){b._tiles.set(a,c),void 0!==b.refreshCallback&&null!=b.refreshCallback&&(b._imgPreviewLoaded=!0,b._imgNotPreviewLoaded=!0,b.refreshCallback())},function(){console.error("Could not load tile : "+a.toString())}),null)},a.prototype.getPreview=function(a,b){if(void 0===b&&(b=1),this._tiles.has(a)){return{tile:this._tiles.get(a),areaToDraw:new Rect(new Position2D(0,0),new Size2D(256,256)),scale:b}}var c=a.z-1;if(c<0)return null;var d=new Position2D(Math.floor(a.x/2),Math.floor(a.y/2)),e=a.x%2,f=a.y%2,g=this.getPreview(new Position3D(d.x,d.y,c),2*b);if(null!=g){var h=new Size2D(g.areaToDraw.size.width/2,g.areaToDraw.size.height/2),i=new Position2D(g.areaToDraw.pos.x+h.width*e,g.areaToDraw.pos.y+h.height*f);return{tile:g.tile,areaToDraw:new Rect(i,h),scale:g.scale}}return null},a.prototype.maxZoomLevel=function(){return Math.max(Math.ceil(Math.log(Math.max(this._width,this._height)/a.TILE_SIZE)/Math.LN2),0)},a.prototype.getZoomLevel=function(a){return Math.max(0,Math.ceil(this.maxZoomLevel()-Math.log(a)/Utils.LOG_HALF))},a.prototype.scaleForLevel=function(a){return Math.pow(.5,this.maxZoomLevel()-a)},a.prototype._loadTile=function(a,b,c){var d=this,e=Utils.hash(a.toString())%this._tilePath.length,f=this._tilePath[e],g=new Image;g.onload=function(){d._loadingTiles.remove(a),b(g)},g.onerror=function(){c()},g.src=ViewerFormatString(f,a),this._loadingTiles.set(a,g)},a.prototype.toString=function(){return this._tilePath[0]},a.TILE_SIZE=256,a.EMPTY_FUNCTION=function(){},a}();a.TileImagePage=b}(a.canvas||(a.canvas={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a,b,c,d){this._id=a,this._fontFamily=b,this._fontSize=c,this._fontStyle=d}return a.prototype.getId=function(){return this._id},a.prototype.getFontFamily=function(){return this._fontFamily},a.prototype.getFontSize=function(){return this._fontSize},a.prototype.getFontStyle=function(){return this._fontStyle},a}();a.AltoStyle=b}(a.alto||(a.alto={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var AltoElementType;!function(a){a[a.ComposedBlock=0]="ComposedBlock",a[a.Illustration=1]="Illustration",a[a.GraphicalElement=2]="GraphicalElement",a[a.TextBlock=3]="TextBlock",a[a.TextLine=4]="TextLine",a[a.String=5]="String",a[a.SP=6]="SP",a[a.HYP=7]="HYP"}(AltoElementType||(AltoElementType={}));var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a,b,c,d,e,f,g,h){this._parent=a,this._type=b,this._id=c,this._width=d,this._height=e,this._hpos=f,this._vpos=g,this._wc=h,this._children=[],this._content=null,this._style=null}return a.prototype.getHeight=function(){return this._height},a.prototype.getHPos=function(){return this._hpos},a.prototype.getId=function(){return this._id},a.prototype.getType=function(){return this._type},a.prototype.getVPos=function(){return this._vpos},a.prototype.getWidth=function(){return this._width},a.prototype.getWordConfidence=function(){return this._wc},a.prototype.getChildren=function(){return this._children},a.prototype.setChildren=function(a){this._children=a},a.prototype.getContent=function(){return this._content},a.prototype.setContent=function(a){this._content=a},a.prototype.getStyle=function(){return this._style},a.prototype.setAltoStyle=function(a){this._style=a},a.prototype.getParent=function(){return this._parent},a.prototype.getBlockHPos=function(){return this._hpos},a.prototype.getBlockVPos=function(){return this._vpos},a.prototype.asRect=function(){return Rect.fromXYWH(this.getHPos(),this.getVPos(),this.getWidth(),this.getHeight())},a}();a.AltoElement=b}(a.alto||(a.alto={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function b(a,b){this._allStyles={},this._rootChilds=new Array,this._allElements=new Array,this._allTextBlocks=new Array,this._allIllustrations=new Array,this._allLines=new Array,this._allComposedBlock=new Array,this._allGraphicalElements=new Array,this._pageWidth=-1,this._pageHeight=-1;for(var c=a.getElementsByTagName("TextStyle"),d=0;d<c.length;d++){var e=c.item(d),f=this.createAltoStyle(e);this._allStyles[f.getId()]=f}var g=b.getElementsByTagName("Page"),h=g.item(0);if(null!=h){this._pageWidth=parseInt(h.getAttribute("WIDTH")),this._pageHeight=parseInt(h.getAttribute("HEIGHT"));var i=h.getElementsByTagName("PrintSpace"),j=i.item(0);null!=j&&(this._rootChilds=this.extractElements(j),this._allElements=this._allTextBlocks.concat(this._allIllustrations).concat(this._allComposedBlock).concat(this._allLines).concat(this._allGraphicalElements))}}return Object.defineProperty(b.prototype,"allElements",{get:function(){return this._allElements},enumerable:!0,configurable:!0}),b.prototype.createAltoStyle=function(b){var c=b.getAttribute("ID"),d=b.getAttribute("FONTFAMILY"),e=parseFloat(b.getAttribute("FONTSIZE")),f=b.getAttribute("FONTSTYLE");return new a.AltoStyle(c,d,e,f)},b.prototype.createAltoElement=function(b,c,d){var e=parseFloat(b.getAttribute("WIDTH")),f=parseFloat(b.getAttribute("HEIGHT")),g=parseFloat(b.getAttribute("HPOS")),h=parseFloat(b.getAttribute("VPOS")),i=parseFloat(b.getAttribute("WC")),j=b.getAttribute("ID"),k=b.getAttribute("STYLEREFS"),l=new a.AltoElement(d,c,j,e,f,g,h,i);if(null!=k){var m=this._allStyles[k];null!=m&&l.setAltoStyle(m)}return l},b.prototype.extractElements=function(a,b){void 0===b&&(b=null);for(var c=new Array,d=a.childNodes,e=0;e<d.length;e++){var f=d.item(e);if(f instanceof Element){var g=this.detectElementType(f);if(null!=g){var h=this.createAltoElement(f,g,b);switch(g){case AltoElementType.ComposedBlock:case AltoElementType.TextBlock:var i=this.extractElements(f,h);h.setChildren(i),c.push(h),g==AltoElementType.TextBlock&&this._allTextBlocks.push(h),g==AltoElementType.ComposedBlock&&this._allComposedBlock.push(h);break;case AltoElementType.Illustration:case AltoElementType.GraphicalElement:g==AltoElementType.Illustration&&this._allIllustrations.push(h),g==AltoElementType.GraphicalElement&&this._allGraphicalElements.push(h);break;case AltoElementType.TextLine:var j=this.extractElements(f,h);h.setChildren(j),c.push(h),this._allLines.push(h);break;case AltoElementType.String:case AltoElementType.SP:case AltoElementType.HYP:h.setContent(f.getAttribute("CONTENT")),c.push(h)}}}}return c},b.prototype.getBlocks=function(){return this._allTextBlocks},b.prototype.getBlockContent=function(a){for(var b="",c=0;c<this._allTextBlocks.length;c++)if(this._allTextBlocks[c].getId()==a){for(var d=this._allTextBlocks[c].getChildren(),e=0;e<d.length;e++)b+=this.getContainerContent(d[e].getId(),this._allLines);break}return b},b.prototype.getContainerContent=function(a,b){for(var c="",d=0;d<b.length;d++)if(b[d].getId()==a){for(var e=b[d].getChildren(),f=0;f<e.length;f++){var g=e[f].getChildren();c+="<span data-id="+e[f].getId()+">";for(var h=0;h<g.length;h++)c+=g[h].getContent()+" ";c+="</span>"}c.trim();break}return c},b.prototype.getLines=function(){return this._allLines},Object.defineProperty(b.prototype,"pageWidth",{get:function(){return this._pageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"pageHeight",{get:function(){return this._pageHeight},enumerable:!0,configurable:!0}),b.prototype.detectElementType=function(a){return"string"==a.nodeName.toLowerCase()?AltoElementType.String:"sp"==a.nodeName.toLowerCase()?AltoElementType.SP:"hyp"==a.nodeName.toLowerCase()?AltoElementType.HYP:"textline"==a.nodeName.toLowerCase()?AltoElementType.TextLine:"textblock"==a.nodeName.toLowerCase()?AltoElementType.TextBlock:"composedblock"==a.nodeName.toLowerCase()?AltoElementType.ComposedBlock:"illustration"==a.nodeName.toLowerCase()?AltoElementType.Illustration:"graphicalelement"==a.nodeName.toLowerCase()?AltoElementType.GraphicalElement:null},b}();a.AltoFile=b}(a.alto||(a.alto={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(a){function b(c,d,e){a.call(this,c,b.TYPE),this._href=d,this._onResolve=e}return __extends(b,a),b.TYPE="RequestAltoModelEvent",b}(a.MyCoReImageViewerEvent);a.RequestAltoModelEvent=b}(a.events||(a.events={}))}(a.components||(a.components={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(b){var c=function(c){function d(a){c.call(this),this._settings=a,this.structureModel=null,this.pageHrefAltoHrefMap=new MyCoReMap,this.altoHrefPageHrefMap=new MyCoReMap,this.altoModelRequestTempStore=new Array}return __extends(d,c),d.prototype.init=function(){"mets"==this._settings.doctype&&(this.trigger(new b.events.WaitForEvent(this,b.events.StructureModelLoadedEvent.TYPE)),this.trigger(new b.events.WaitForEvent(this,b.events.RequestAltoModelEvent.TYPE)))},d.prototype.handle=function(a){var c=this;if(a.type==b.events.RequestAltoModelEvent.TYPE&&(null==this.structureModel||this.structureModel._textContentPresent)){var d=a,e=this.detectHrefs(d._href),f=e.altoHref,g=e.imgHref;this.pageHrefAltoHrefMap.has(g)?this.resolveAltoModel(g,function(a){d._onResolve(g,f,a)}):null==this.structureModel&&this.altoModelRequestTempStore.push(d)}if(a.type==b.events.StructureModelLoadedEvent.TYPE){var h=a;if(this.structureModel=h.structureModel,h.structureModel._textContentPresent){this.fillAltoHrefMap();for(var i in this.altoModelRequestTempStore){var d=this.altoModelRequestTempStore[i],j=this.detectHrefs(d._href),k=j.altoHref,l=j.imgHref;!function(a,b,d){c.pageHrefAltoHrefMap.has(b)?c.resolveAltoModel(b,function(c){d(b,a,c)}):console.warn("RPE : altoHref not found!")}(k,l,d._onResolve)}this.altoModelRequestTempStore=[],this.trigger(new b.events.WaitForEvent(this,b.events.RequestTextContentEvent.TYPE))}}},d.prototype.detectHrefs=function(a){var b,c;return this.altoHrefPageHrefMap.has(a)?(b=a,c=this.altoHrefPageHrefMap.get(b)):(c=a,b=this.pageHrefAltoHrefMap.get(c)),{altoHref:b,imgHref:c}},d.prototype.fillAltoHrefMap=function(){var a=this;this.structureModel.imageList.forEach(function(b){if(b.additionalHrefs.has(d.TEXT_HREF)){var c=b.additionalHrefs.get(d.TEXT_HREF);a.pageHrefAltoHrefMap.set(b.href,c),a.altoHrefPageHrefMap.set(c,b.href)}})},Object.defineProperty(d.prototype,"handlesEvents",{get:function(){return"mets"==this._settings.doctype?[b.events.RequestAltoModelEvent.TYPE,b.events.StructureModelLoadedEvent.TYPE]:[]},enumerable:!0,configurable:!0}),d.prototype.resolveAltoModel=function(a,b){var c=this,e=this.pageHrefAltoHrefMap.get(a);d.altoHrefModelMap.has(e)?b(d.altoHrefModelMap.get(e)):this.loadAltoXML(this._settings.derivateURL+e,function(d){c.loadedAltoModel(a,e,d,b)},function(a){console.error("Failed to receive alto from server... ",a)})},d.prototype.loadAltoXML=function(a,b,c){var d={url:a,type:"GET",dataType:"xml",async:!0,success:b,error:c};jQuery.ajax(d)},d.prototype.loadedAltoModel=function(b,c,e,f){var g=e.getElementsByTagName("Styles"),h=g.item(0),i=e.getElementsByTagName("Layout"),j=i.item(0);if(null!=h&&null!=j){var k=new a.widgets.alto.AltoFile(h,j);d.altoHrefModelMap.set(c,k),f(k)}},d.altoHrefModelMap=new MyCoReMap,d.TEXT_HREF="AltoHref",d}(b.ViewerComponent);b.MyCoReAltoModelProvider=c}(a.components||(a.components={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReAltoModelProvider);var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.generateHtml=function(a,b){var c=this,d="sans-serif",e=document.createElement("div");e.style.position="absolute",e.style.whiteSpace="nowrap",e.style.fontFamily="sans-serif",e.setAttribute("data-id",b);var f=(document.createElement("span"),document.createElement("canvas")),g=f.getContext("2d"),h=.002*a.pageHeight,i=null,j=a.getBlocks().map(function(a){var b=null!==i&&(i.getVPos()+i.getHeight()+h<a.getVPos()||i.getHPos()+i.getWidth()+h<a.getHPos()),e=c.getFontSize(g,a,d);e*=.9;var f="<div";return f+=" class='altoBlock'",f+=" style='",f+=" transform: translate("+Math.round(a.getHPos())+"px,"+Math.round(a.getVPos())+"px );",f+=" width: "+a.getWidth()+"px;",f+=" height: "+a.getHeight()+"px;",f+=" font-size: "+e+"px;",b&&(f+=" outline: "+h+"px solid white;"),f+="'>",a.getChildren().map(function(b){var d="<p";d+=" class='altoLine'",d+=" style='height: "+b.getHeight()+"px;",d+=" width: "+b.getWidth()+"px;",d+=" transform: translate("+Math.round(b.getHPos()-a.getHPos())+"px, "+Math.round(b.getVPos()-a.getVPos())+"px);";var e=b.getStyle();if(null!=e){var g=e.getFontStyle();null!=g&&("italic"==g?d+=" font-style: italic;":"bold"==g&&(d+=" font-weight: bold;"))}d+="'>"+c.getLineAsElement(b)+"</p>",f+=d}),f+="</div>",i=a,f});return e.innerHTML=j.join(""),e},a.prototype.getWordsArray=function(a){return a.getChildren().filter(function(a){return a.getType()===AltoElementType.String})},a.prototype.getLineAsString=function(a){var b=document.createElement("span");return this.getWordsArray(a).map(function(a){return b.innerText=a.getContent(),b.innerHTML}).join(" ")},a.prototype.getFontSize=function(a,b,c){var d=this,e=function(a){var b=a.getStyle();if(null!==b){var c=b.getFontStyle();return null!==c?c+" ":""}return""},f=function(f,g){var h=d.getLineAsString(f);a.font=e(f)+g+"px "+c;var i=b.getWidth()/a.measureText(h).width;return i>1?g:g*i};if(1===b.getChildren().length){var g=b.getChildren()[0];return f(g,g.getHeight())}var h=b.getChildren().reduce(function(a,b){return Math.max(a,b.getHeight())},0);return b.getChildren().forEach(function(a){h=f(a,h)}),h},a.prototype.getLineAsElement=function(a){var b=document.createElement("word");return this.getWordsArray(a).map(function(a){return b.innerText=a.getContent(),'<span data-vpos="'+a.getVPos()+'"\n                            data-hpos="'+a.getHPos()+'"\n                            data-word="'+a.getContent()+'"\n                            data-width="'+a.getWidth()+'"\n                            data-height="'+a.getHeight()+'"\n                            data-wc="'+a.getWordConfidence()+'"\n                        >'+b.innerHTML+"</span>"}).join(" ")},a}();a.AltoHTMLGenerator=b}(a.alto||(a.alto={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(b){!function(c){var d=a.viewer.components.events.RequestAltoModelEvent,e=a.viewer.widgets.alto.AltoHTMLGenerator,f=a.viewer.components.events.PageLoadedEvent,g=function(g){function h(a){g.call(this),this._settings=a,this._imageInformationMap=new MyCoReMap,this._imagePageMap=new MyCoReMap,this._altoHTMLGenerator=new e,this._imageHTMLMap=new MyCoReMap,this._imageCallbackMap=new MyCoReMap}return __extends(h,g),h.prototype.init=function(){"mets"==this._settings.doctype&&this.trigger(new c.events.WaitForEvent(this,c.events.RequestPageEvent.TYPE))},
h.prototype.getPage=function(a,b){var c=this;if(this._imagePageMap.has(a))b(this._imagePageMap.get(a));else if(this._imageCallbackMap.has(a))this._imageCallbackMap.get(a).push(b);else{var e=new Array;e.push(b),this._imageCallbackMap.set(a,e),this.getPageMetadata(a,function(b){var e=c.createPageFromMetadata(a,b);c._imageHTMLMap.has(a)||c.trigger(new d(c,a,function(b,d,f){if(!c._imageHTMLMap.has(a)){var g=c._altoHTMLGenerator.generateHtml(f,d);e.getHTMLContent().value=g,c._imageHTMLMap.set(a,g)}}));for(var g,h=c._imageCallbackMap.get(a);g=h.pop();)g(e);c._imagePageMap.set(a,e),c.trigger(new f(c,a,e))})}},h.prototype.createPageFromMetadata=function(a,c){var d=this,e=this._settings.tileProviderPath.split(","),f=new Array;return e.forEach(function(a){f.push(a+d._settings.derivate+c.path+"/{z}/{y}/{x}.jpg")}),new b.widgets.canvas.TileImagePage(a,c.width,c.height,f)},h.prototype.getPageMetadata=function(b,c){var d=this;if(b="/"==b.charAt(0)?b.substr(1):b,this._imageInformationMap.has(b))c(this._imageInformationMap.get(b));else{var e="/"+b;a.viewer.widgets.image.XMLImageInformationProvider.getInformation(this._settings.imageXmlPath+this._settings.derivate,e,function(a){d._imageInformationMap.set(b,a),c(a)},function(a){console.log("Error while loading ImageInformations",+a.toString())})}},Object.defineProperty(h.prototype,"handlesEvents",{get:function(){return"mets"==this._settings.doctype?[c.events.RequestPageEvent.TYPE]:[]},enumerable:!0,configurable:!0}),h.prototype.handle=function(a){if(a.type==c.events.RequestPageEvent.TYPE){var b=a;this.getPage(b._pageId,function(a){b._onResolve(b._pageId,a)})}},h}(c.ViewerComponent);c.MyCoReMetsPageProviderComponent=g}(b.components||(b.components={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReMetsPageProviderComponent);var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(a){function b(b){var c=this;a.call(this,b,"CreatePDF"),this.checkEventHandler=null,this.rangeInputEventHandler=null,this.chapterInputEventHandler=null,this.okayClickHandler=null,this._inputRow=jQuery("<div></div>"),this._inputRow.addClass("row"),this._inputRow.appendTo(this.modalBody),this._previewBox=jQuery("<div></div>"),this._previewBox.addClass("printPreview"),this._previewBox.addClass("col-sm-12"),this._previewBox.addClass("thumbnail"),this._previewBox.appendTo(this._inputRow),this._previewImage=jQuery("<img />"),this._previewImage.appendTo(this._previewBox),this._pageSelectBox=jQuery("<form></form>"),this._pageSelectBox.addClass("printForm"),this._pageSelectBox.addClass("col-sm-12"),this._pageSelectBox.appendTo(this._inputRow),this._selectGroup=jQuery("<div></div>"),this._selectGroup.addClass("form-group"),this._selectGroup.appendTo(this._pageSelectBox),this._createRadioAllPages(),this._createRadioCurrentPage(),this._createRadioRangePages(),this._createRadioChapters(),this._validationRow=jQuery("<div></div>"),this._validationRow.addClass("row"),this._validationRow.appendTo(this.modalBody),this._validationMessage=jQuery("<p></p>"),this._validationMessage.addClass("col-sm-12"),this._validationMessage.addClass("pull-right"),this._validationMessage.appendTo(this._validationRow),this._okayButton=jQuery("<a>OK</a>"),this._okayButton.attr("type","button"),this._okayButton.addClass("btn btn-default"),this._okayButton.appendTo(this.modalFooter),this._maximalPageMessage=jQuery("<div class='row'><span class='col-sm-12 message'></span></div>"),this._maximalPageMessage.appendTo(this.modalBody),this._maximalPageNumber=jQuery("<span></span>"),this._maximalPageNumber.text(""),this._maximalPageMessage.children().append(this._maximalPageNumber),this._okayButton.click(function(){null!=c.okayClickHandler&&c.okayClickHandler()})}return __extends(b,a),b.prototype._createRadioAllPages=function(){var a=this;this._radioAllPages=jQuery("<div></div>"),this._radioAllPages.addClass("radio"),this._radioAllPagesLabelElement=jQuery("<label></label>"),this._radioAllPagesInput=jQuery("<input>"),this._radioAllPagesInput.attr("type","radio"),this._radioAllPagesInput.attr("name",b.INPUT_IDENTIFIER),this._radioAllPagesInput.attr("id",b.INPUT_IDENTIFIER),this._radioAllPagesInput.attr("value",b.INPUT_ALL_VALUE),this._radioAllPagesLabel=jQuery("<p></p>"),this._radioAllPagesInput.change(function(){null!=a.checkEventHandler&&a.checkEventHandler(b.INPUT_ALL_VALUE)}),this._radioAllPages.append(this._radioAllPagesLabelElement),this._radioAllPagesLabelElement.append(this._radioAllPagesInput),this._radioAllPagesLabelElement.append(this._radioAllPagesLabel),this._radioAllPages.appendTo(this._selectGroup)},b.prototype._createRadioCurrentPage=function(){var a=this;this._radioCurrentPage=jQuery("<div></div>"),this._radioCurrentPage.addClass("radio"),this._radioCurrentPageLabelElement=jQuery("<label></label>"),this._radioCurrentPageInput=jQuery("<input>"),this._radioCurrentPageInput.attr("type","radio"),this._radioCurrentPageInput.attr("name",b.INPUT_IDENTIFIER),this._radioCurrentPageInput.attr("id",b.INPUT_IDENTIFIER),this._radioCurrentPageInput.attr("value",b.INPUT_CURRENT_VALUE),this._radioCurrentPageLabel=jQuery("<p></p>"),this._radioCurrentPageInput.change(function(){null!=a.checkEventHandler&&a.checkEventHandler(b.INPUT_CURRENT_VALUE)}),this._radioCurrentPage.append(this._radioCurrentPageLabelElement),this._radioCurrentPageLabelElement.append(this._radioCurrentPageInput),this._radioCurrentPageLabelElement.append(this._radioCurrentPageLabel),this._radioCurrentPage.appendTo(this._selectGroup)},b.prototype._createRadioRangePages=function(){var a=this;this._radioRangePages=jQuery("<div></div>"),this._radioRangePages.addClass("radio"),this._radioRangePagesLabelElement=jQuery("<label></label>"),this._radioRangePagesInput=jQuery("<input>"),this._radioRangePagesInput.attr("type","radio"),this._radioRangePagesInput.attr("name",b.INPUT_IDENTIFIER),this._radioRangePagesInput.attr("id",b.INPUT_IDENTIFIER),this._radioRangePagesInput.attr("value",b.INPUT_RANGE_VALUE),this._radioRangePagesLabel=jQuery("<p></p>"),this._radioRangePagesInputText=jQuery("<input>"),this._radioRangePagesInputText.addClass("form-control"),this._radioRangePagesInputText.attr("type","text"),this._radioRangePagesInputText.attr("name",b.INPUT_RANGE_TEXT_IDENTIFIER),this._radioRangePagesInputText.attr("id",b.INPUT_RANGE_TEXT_IDENTIFIER),this._radioRangePagesInputText.attr("placeholder","1,3-5,8");var c=this,d=function(){null!=c.checkEventHandler&&c.checkEventHandler(b.INPUT_RANGE_VALUE),a._radioRangePagesInputText.focus()};this._radioRangePagesInput.change(d),this._radioRangePagesInput.click(d),this._radioRangePagesInputText.click(function(){a.allChecked=!1,a.currentChecked=!1,a.rangeChecked=!0,d(),a._radioRangePagesInputText.focus()}),this._radioRangePagesInputText.keyup(function(){null!=c.rangeInputEventHandler&&a.rangeInputEventHandler(a._radioRangePagesInputText.val())}),this._radioRangePages.append(this._radioRangePagesLabelElement),this._radioRangePagesLabelElement.append(this._radioRangePagesInput),this._radioRangePagesLabelElement.append(this._radioRangePagesLabel),this._radioRangePagesLabelElement.append(this._radioRangePagesInputText),this._radioRangePages.appendTo(this._selectGroup)},b.prototype._createRadioChapters=function(){var a=this;this._radioChapter=jQuery("<div></div>"),this._radioChapter.addClass("radio"),this._radioChapterInput=jQuery("<input>"),this._radioChapterInput.attr("type","radio"),this._radioChapterInput.attr("name",b.INPUT_IDENTIFIER),this._radioChapterInput.attr("id",b.INPUT_IDENTIFIER),this._radioChapterInput.attr("value",b.INPUT_CHAPTER_VALUE),this._chapterLabelElement=jQuery("<label></label>"),this._radioChapterLabel=jQuery("<p></p>"),this._chapterSelect=jQuery("<select></select>"),this._radioRangePages.append(this._chapterLabelElement),this._chapterLabelElement.append(this._radioChapterInput),this._chapterLabelElement.append(this._radioChapterLabel),this._chapterLabelElement.append(this._chapterSelect),this._radioChapter.appendTo(this._selectGroup);var c=function(){null!=a.checkEventHandler&&a.checkEventHandler(b.INPUT_CHAPTER_VALUE)};this._radioChapterInput.change(c),this._chapterSelect.change(function(){c(),a.chapterChecked=!0,null!=a.chapterInputEventHandler&&a.chapterInputEventHandler(a._chapterSelect.val())})},Object.defineProperty(b.prototype,"rangeChecked",{get:function(){return this._radioRangePagesInput.prop("checked")},set:function(a){this._radioRangePagesInput.prop("checked",a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"allChecked",{get:function(){return this._radioAllPagesInput.prop("checked")},set:function(a){this._radioAllPagesInput.prop("checked",a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentChecked",{get:function(){return this._radioCurrentPageInput.prop("checked")},set:function(a){this._radioCurrentPageInput.prop("checked",a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"chapterChecked",{get:function(){return this._radioChapterInput.prop("checked")},set:function(a){this._radioChapterInput.prop("checked",a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"validationResult",{set:function(a){a?(this._validationMessage.removeClass("text-danger"),this._validationMessage.addClass("text-success"),this._okayButton.removeClass("disabled")):(this._validationMessage.removeClass("text-success"),this._validationMessage.addClass("text-danger"),this._okayButton.addClass("disabled"))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"validationMessage",{get:function(){return this._validationMessage.text()},set:function(a){this._validationMessage.text(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentPageLabel",{get:function(){return this._radioCurrentPageLabel.text()},set:function(a){this._radioCurrentPageLabel.text(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"allPagesLabel",{get:function(){return this._radioAllPagesLabel.text()},set:function(a){this._radioAllPagesLabel.text(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rangeLabel",{get:function(){return this._radioRangePagesLabel.text()},set:function(a){this._radioRangePagesLabel.text(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"previewImageSrc",{get:function(){return this._previewImage.attr("src")},set:function(a){this._previewImage.attr("src",a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rangeInputVal",{get:function(){return this._radioRangePagesInputText.val()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rangeInputEnabled",{get:function(){return"true"==this._radioRangePagesInputText.attr("enabled")},set:function(a){this._radioRangePagesInputText.val(""),this._radioRangePagesInputText.attr("enabled",a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"chapterLabel",{get:function(){return this._radioChapterLabel.text()},set:function(a){this._radioChapterLabel.text(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maximalPages",{set:function(a){this._maximalPageNumber.text(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maximalPageMessage",{set:function(a){this._maximalPageNumber.detach();var b=this._maximalPageMessage.find(".message");b.text(a+" "),b.append(this._maximalPageNumber)},enumerable:!0,configurable:!0}),b.prototype.setChapterTree=function(a){this._chapterSelect.html(a.map(function(a){return'<option value="'+a.id+'">'+a.label+"</option>"}).join(""))},Object.defineProperty(b.prototype,"chapterInputVal",{get:function(){return this._chapterSelect.val()},enumerable:!0,configurable:!0}),b.INPUT_IDENTIFIER="pages",b.INPUT_RANGE_IDENTIFIER="range",b.INPUT_RANGE_TEXT_IDENTIFIER=b.INPUT_RANGE_IDENTIFIER+"-text",b.INPUT_CHAPTER_VALUE="chapter",b.INPUT_ALL_VALUE="all",b.INPUT_RANGE_VALUE="range",b.INPUT_CURRENT_VALUE="current",b}(a.IviewModalWindow);a.ViewerPrintModalWindow=b}(a.modal||(a.modal={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(b){!function(c){var d=function(d){function e(a){d.call(this),this._settings=a,this._enabled=null!=this._settings.pdfCreatorStyle&&0!=this._settings.pdfCreatorStyle.length||this._settings.pdfCreatorURI}return __extends(e,d),Object.defineProperty(e.prototype,"handlesEvents",{get:function(){return"mets"==this._settings.doctype&&this._enabled?[b.widgets.toolbar.events.ButtonPressedEvent.TYPE,c.events.LanguageModelLoadedEvent.TYPE,c.events.StructureModelLoadedEvent.TYPE,c.events.ImageChangedEvent.TYPE,c.events.ProvideToolbarModelEvent.TYPE]:[]},enumerable:!0,configurable:!0}),e.prototype.init=function(){"mets"==this._settings.doctype&&this._enabled&&(this._resolveMaxRequests(),this.initModalWindow(),this.trigger(new c.events.WaitForEvent(this,c.events.LanguageModelLoadedEvent.TYPE)),this.trigger(new c.events.WaitForEvent(this,c.events.StructureModelLoadedEvent.TYPE)),this.trigger(new c.events.WaitForEvent(this,c.events.ProvideToolbarModelEvent.TYPE)),this.trigger(new c.events.ComponentInitializedEvent(this)))},e.prototype.handle=function(a){var d=this;if(a.type==c.events.ProvideToolbarModelEvent.TYPE){var e=a;this._printButton=new b.widgets.toolbar.ToolbarButton("PrintButton","PDF","",""),this._settings.mobile&&(this._printButton.icon="file-pdf-o",this._printButton.label=""),"MyCoReFrameToolbar"==e.model.name?e.model._zoomControllGroup.addComponent(this._printButton):e.model._actionControllGroup.addComponent(this._printButton)}if(a.type==c.events.LanguageModelLoadedEvent.TYPE){var f=a,g=f.languageModel;this._printButton.tooltip=g.getTranslation("toolbar.pdf"),this._modalWindow.closeLabel=g.getTranslation("createPdf.cancel"),this._modalWindow.currentPageLabel=g.getTranslation("createPdf.range.currentPage"),this._modalWindow.allPagesLabel=g.getTranslation("createPdf.range.allPages"),this._modalWindow.rangeLabel=g.getTranslation("createPdf.range.manual"),this._modalWindow.chapterLabel=g.getTranslation("createPdf.range.chapter"),this._modalWindow.title=g.getTranslation("createPdf.title"),this._languageModel=g,this._modalWindow.maximalPageMessage=g.getTranslation("createPdf.maximalPages")}if(a.type==b.widgets.toolbar.events.ButtonPressedEvent.TYPE){"PrintButton"==a.button.id&&("pdf"==this._settings.doctype?window.location.href=this._settings.metsURL:this._modalWindow.show())}if(a.type==c.events.StructureModelLoadedEvent.TYPE){var h=a;this._structureModel=h.structureModel,this._modalWindow.setChapterTree(this.getChapterViewModel())}if(a.type==c.events.ImageChangedEvent.TYPE){var i=a;this._currentImage=i.image,this._modalWindow.currentChecked&&void 0!==this._currentImage&&this._currentImage.requestImgdataUrl(function(a){d._modalWindow.previewImageSrc=a})}},e.prototype.getChapterViewModel=function(a,b){void 0===a&&(a=this._structureModel.rootChapter),void 0===b&&(b=0);for(var c=[],d="",e=0;e<b;e++)d+="&nbsp;&nbsp;";var f=d+a.label,g=25+d.length;f.length>g&&(f=f.substr(0,g)+"..."),c.push({id:a.id,label:f});for(var h=b+1,i=0,j=a.chapter;i<j.length;i++){var k=j[i];c.push.apply(c,this.getChapterViewModel(k,h))}return c},e.prototype.initModalWindow=function(){var b=this;this._modalWindow=new a.viewer.widgets.modal.ViewerPrintModalWindow(this._settings.mobile),this._modalWindow.checkEventHandler=function(a){"range"==a?b.handleRangeChecked():"chapter"==a?b.handleChapterChecked():(b._modalWindow.rangeInputEventHandler=null,b._modalWindow.chapterInputEventHandler=null,b._modalWindow.rangeInputEnabled=!1,"all"==a?b.handleAllChecked():"current"==a&&b.handleCurrentChecked())},this._modalWindow.okayClickHandler=function(){var a;if(b._modalWindow.currentChecked&&(a=b._currentImage.order),b._modalWindow.allChecked&&(a="1-"+b._structureModel._imageList.length),b._modalWindow.rangeChecked&&(a=b._modalWindow.rangeInputVal),b._modalWindow.chapterChecked){var c=b.findChapterWithID(b._modalWindow.chapterInputVal);a=b.getRangeOfChapter(c)}window.location.href=b.buildPDFRequestLink(a)},this._modalWindow.currentChecked=!0},e.prototype.handleChapterChecked=function(){var a=this;this._modalWindow.rangeInputEnabled=!1,this._modalWindow.validationMessage="",this._modalWindow.previewImageSrc=null,this._modalWindow.chapterInputEventHandler=function(b){var c=a.findChapterWithID(b),d=a.getRangeOfChapter(c),e=a.validateRange(d);e.valid?(a._modalWindow.validationMessage="",a._modalWindow.validationResult=!0,a._structureModel.imageList[e.firstPage].requestImgdataUrl(function(b){a._modalWindow.previewImageSrc=b})):(a._modalWindow.validationMessage=e.text,a._modalWindow.validationResult=e.valid,a._modalWindow.previewImageSrc=null)},this._modalWindow.chapterInputEventHandler(this._modalWindow.chapterInputVal)},e.prototype.handleCurrentChecked=function(){var a=this;this._modalWindow.validationMessage="",this._currentImage.requestImgdataUrl(function(b){a._modalWindow.previewImageSrc=b}),this._modalWindow.validationResult=!0},e.prototype.handleAllChecked=function(){var a=this;this._structureModel.imageList.length+1>this._maxPages?(this._modalWindow.validationMessage=this._languageModel.getTranslation("createPdf.errors.tooManyPages"),this._modalWindow.validationResult=!1,this._modalWindow.previewImageSrc=null):(this._modalWindow.validationResult=!0,this._structureModel.imageList[0].requestImgdataUrl(function(b){a._modalWindow.previewImageSrc=b}))},e.prototype.handleRangeChecked=function(){var a=this;this._modalWindow.rangeInputEnabled=!0,this._modalWindow.validationMessage="",this._modalWindow.previewImageSrc=null,this._modalWindow.rangeInputEventHandler=function(b){var c=a.validateRange(b);c.valid?(a._modalWindow.validationMessage="",a._modalWindow.validationResult=!0,a._structureModel.imageList[c.firstPage].requestImgdataUrl(function(b){a._modalWindow.previewImageSrc=b})):(a._modalWindow.validationMessage=c.text,a._modalWindow.validationResult=c.valid,a._modalWindow.previewImageSrc=null)}},e.prototype.buildPDFRequestLink=function(a){var b="{metsURL}/mets.xml?XSL.Style={pdfCreatorStyle}",c=encodeURIComponent(ViewerFormatString(b,this._settings));return this._settings.metsLocation=c,this._settings.pages=a,ViewerFormatString(this._settings.pdfCreatorFormatString||"{pdfCreatorURI}?mets={metsLocation}&pages={pages}",this._settings)},e.prototype.buildRestrictionLink=function(){return ViewerFormatString(this._settings.pdfCreatorRestrictionFormatString||"{pdfCreatorURI}?getRestrictions",this._settings)},e.prototype._resolveMaxRequests=function(){var a=this;jQuery.ajax({type:"GET",dataType:"json",url:this.buildRestrictionLink(),crossDomain:!0,complete:function(a,b){},success:function(b){a._maxPages=parseInt(b.maxPages),a._modalWindow.maximalPages=a._maxPages.toString()}})},e.prototype.findChapterWithID=function(a,b){if(void 0===b&&(b=this._structureModel.rootChapter),b.id==a)return b;for(var c=0,d=b.chapter;c<d.length;c++){var e=d[c],f=this.findChapterWithID(a,e);if(null!=f)return f}return null},e.prototype.validateRange=function(a){var b=a.split(","),c=99999;if(0==a.length)return{valid:!1,text:this._languageModel.getTranslation("createPdf.errors.noPages")};for(var d=0,e=this._maxPages,f=0,g=b;f<g.length;f++){var h=g[f];if(-1==h.indexOf("-")){if(!this.isValidPage(h))return{valid:!1,text:this._languageModel.getTranslation("createPdf.errors.rangeInvalid")};var i=parseInt(h);i<c&&(c=i),d++}else{var j=h.split("-");if(2!=j.length)return{valid:!1,text:this._languageModel.getTranslation("createPdf.errors.rangeInvalid")};var k=j[0],l=j[1];if(!this.isValidPage(k)){var m=ViewerFormatString(this._languageModel.getTranslation("createPdf.errors.rangeInvalid"),{0:k});return{valid:!1,text:m}}if(!this.isValidPage(l)){var m=ViewerFormatString(this._languageModel.getTranslation("createPdf.errors.rangeInvalid"),{0:l});return{valid:!1,text:m}}var n=parseInt(k),o=parseInt(l);if(n>=o)return{valid:!1,text:this._languageModel.getTranslation("createPdf.errors.rangeInvalid")};if((d+=o-n)>e){var m=ViewerFormatString(this._languageModel.getTranslation("createPdf.errors.tooManyPages"),{0:e.toString()});return{valid:!1,text:m}}n<c&&(c=n)}}return{valid:!0,text:"",firstPage:c-1}},e.prototype.isValidPage=function(a){return void 0!==this._structureModel._imageList[parseInt(a)-1]&&!isNaN(a)},e.prototype.getRangeOfChapter=function(a){for(var b=this._structureModel._imageToChapterMap,c=[],d=function(a,b){return a==b||null!=b.parent&&d(a,b.parent)},e=null,f=null,g=0,h=this._structureModel.imageList;g<h.length;g++){var i=h[g];if(b.has(i.id)){var j=b.get(i.id);if(d(a,j)){null==e?e=i:f=i;continue}}null!=e&&null!=f?c.push(e.order+"-"+f.order):null!=e&&c.push(e.order+""),e=f=null}return null!=e&&null!=f?c.push(e.order+1+"-"+(f.order+1)):null!=e&&c.push(e.order+1+""),c.join(",")},e}(c.ViewerComponent);c.MyCoRePrintComponent=d}(b.components||(b.components={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoRePrintComponent);var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){this.selectedChapter=null,this.highlightedChapter=null,this.fadeAnimation=null,this.chaptersToClear=new MyCoReMap,this.enabled=!0}return a.prototype.isEnabled=function(){return this.enabled},a.prototype.setEnabled=function(a){this.enabled=a},a.prototype.draw=function(a,b,c,d){if(void 0===d&&(d=!1),this.isEnabled()){var e=this.isChapterSelected(),f=this.isHighlighted(),g=null!=this.fadeAnimation&&this.fadeAnimation.isRunning;if(g||e||f||this.chaptersToClear.clear(),e&&this.chaptersToClear.set("selected",this.selectedChapter),f?this.chaptersToClear.set("highlighted",this.highlightedChapter):e&&this.chaptersToClear.remove("highlighted"),g||e||f){var h=e?"rgba(0,0,0,0.4)":"rgba(0,0,0,0.15)";null!=this.fadeAnimation&&(h="rgba(0,0,0,"+this.fadeAnimation.value+")"),this.isLinkedWithoutBlocks(b)||this.darkenPage(a,c,h),this.clearRects(a,b)}f&&e&&this.drawRects(a,b,this.highlightedChapter.boundingBoxMap,"rgba(0,0,0,0.2)")}},a.prototype.isChapterSelected=function(){return null!=this.selectedChapter&&!this.selectedChapter.boundingBoxMap.isEmpty()},a.prototype.isHighlighted=function(){var a=null!=this.highlightedChapter&&!this.highlightedChapter.boundingBoxMap.isEmpty();return a&&this.isChapterSelected()?this.highlightedChapter.chapterId!==this.selectedChapter.chapterId:a},a.prototype.isLinkedWithoutBlocks=function(a){return!this.chaptersToClear.filter(function(b,c){var d=c.boundingBoxMap.get(a);return null!=d&&0===d.length}).isEmpty()},a.prototype.darkenPage=function(a,b,c){a.save(),a.strokeStyle=c,a.fillStyle=c,a.beginPath(),a.rect(0,0,b.width,b.height),a.closePath(),a.fill(),a.restore()},a.prototype.clearRects=function(a,b){a.save(),this.chaptersToClear.values.forEach(function(c){c.boundingBoxMap.hasThen(b,function(b){b.forEach(function(b){a.clearRect(b.getX(),b.getY(),b.getWidth(),b.getHeight())})})}),a.restore()},a.prototype.drawRects=function(a,b,c,d){a.save(),a.strokeStyle=d,a.fillStyle=d,a.beginPath(),c.hasThen(b,function(b){b.forEach(function(b){a.rect(b.getX(),b.getY(),b.getWidth(),b.getHeight())})}),a.closePath(),a.fill(),a.restore()},a}();a.HighlightAltoChapterCanvasPageLayer=b}(a.canvas||(a.canvas={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(b){var c=b.events.RequestAltoModelEvent,d=b.events.WaitForEvent,e=function(e){function h(b,c){e.call(this),this._settings=b,this.container=c,this.pageLayout=null,this.highlightLayer=new a.widgets.canvas.HighlightAltoChapterCanvasPageLayer,this._altoChapterContainer=null,this.selectedChapter=null,this.highlightedChapter=null}return __extends(h,e),h.prototype.init=function(){"mets"==this._settings.doctype&&(this.trigger(new d(this,b.events.PageLayoutChangedEvent.TYPE)),this.trigger(new d(this,b.events.RequestPageEvent.TYPE)),this.trigger(new b.events.AddCanvasPageLayerEvent(this,0,this.highlightLayer)))},Object.defineProperty(h.prototype,"handlesEvents",{get:function(){return"mets"==this._settings.doctype?[b.events.ChapterChangedEvent.TYPE,b.events.PageLayoutChangedEvent.TYPE,b.events.RequestPageEvent.TYPE,b.events.MetsLoadedEvent.TYPE,b.events.TextEditEvent.TYPE]:[]},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"isEnabled",{get:function(){return null!=this._model&&this._model._textContentPresent},enumerable:!0,configurable:!0}),h.prototype.getPageLayout=function(){return this.pageLayout},h.prototype.getPageController=function(){return this.pageLayout.getPageController()},h.prototype.getAltoChapterContainer=function(){return this._altoChapterContainer},h.prototype.setChapter=function(a,c,d){if(void 0===c&&(c=!1),void 0===d&&(d=!1),(d||this.selectedChapter!==a)&&(this.selectedChapter=a,null!==this._altoChapterContainer&&this._altoChapterContainer.hasLoadedPages()&&(this.highlightLayer.selectedChapter=null!=a?this._altoChapterContainer.chapters.get(a):null,this.handleDarkenPageAnimation(),this.trigger(new b.events.RedrawEvent(this)),c))){var e=this._altoChapterContainer.getChapter(a);this.trigger(new b.events.ChapterChangedEvent(this,e))}},h.prototype.setHighlightChapter=function(a){null!==this._altoChapterContainer&&this._altoChapterContainer.hasLoadedPages()&&this.highlightedChapter!==a&&(this.highlightLayer.highlightedChapter=null!=a?this._altoChapterContainer.chapters.get(a):null,this.highlightedChapter=a,null==this.selectedChapter&&this.handleDarkenPageAnimation(),this.trigger(new b.events.RedrawEvent(this)))},h.prototype.handleDarkenPageAnimation=function(){var b=null!=this.selectedChapter,c=null!=this.highlightedChapter,d=0;if(null!=this.highlightLayer.fadeAnimation&&(d=this.highlightLayer.fadeAnimation.value,this.getPageController().removeAnimation(this.highlightLayer.fadeAnimation)),!b&&!c){if(0==d)return;return this.highlightLayer.fadeAnimation=new a.widgets.canvas.InterpolationAnimation(1e3,d,0),void this.getPageController().addAnimation(this.highlightLayer.fadeAnimation)}var e=b?.4:.15;this.highlightLayer.fadeAnimation=new a.widgets.canvas.InterpolationAnimation(1e3,d,e),this.getPageController().addAnimation(this.highlightLayer.fadeAnimation)},h.prototype.handle=function(a){var d=this;if(a.type==b.events.MetsLoadedEvent.TYPE){var e=a;if(this._model=e.mets.model,!this.isEnabled)return;this._altoChapterContainer=new g(this._model),null!=this.selectedChapter&&this.setChapter(this.selectedChapter,!1,!0),this.trigger(new b.events.RequestDesktopInputEvent(this,new f(this)))}if(a.type==b.events.RequestPageEvent.TYPE){var h=a;this.trigger(new c(this,h._pageId,function(a,b,c){d._altoChapterContainer.addPage(h._pageId,b,c)}))}if(a.type==b.events.ChapterChangedEvent.TYPE){var i=a;if(null==i||null==i.chapter)return;this.setChapter(i.chapter.id)}if(a.type==b.events.PageLayoutChangedEvent.TYPE&&(this.pageLayout=a.pageLayout),a.type==b.events.TextEditEvent.TYPE){var j=a;this.highlightLayer.setEnabled(!j.edit)}},h}(b.ViewerComponent);b.MyCoReHighlightAltoComponent=e;var f=function(a){function b(b){a.call(this),this.component=b}return __extends(b,a),b.prototype.mouseClick=function(a){var b=this.getChapterId(a);this.component.setChapter(b,!0)},b.prototype.mouseMove=function(a){var b=this.getChapterId(a);this.component.setHighlightChapter(b)},b.prototype.getChapterId=function(a){var b=this.component.getPageLayout();if(null==b)return null;var c=b.getPageHitInfo(a);if(null==c.id)return null;var d=this.component.getAltoChapterContainer();if(null===d)return null;var e=d.chapters,f=d.pageChapterMap,g=f.get(c.id);if(null==g||g.length<=0)return null;for(var h=0,i=g;h<i.length;h++){var j=i[h],k=e.get(j),l=k.boundingBoxMap.get(c.id);if(null!=l)for(var m=0,n=l;m<n.length;m++){var o=n[m],p=o.scale(c.pageAreaInformation.scale);if(p.intersects(c.hit))return j}}return null},b}(a.widgets.canvas.DesktopInputAdapter),g=function(){function a(a){var b=this;this._model=a,this.chapters=new MyCoReMap,this.pageChapterMap=new MyCoReMap,this._loadedPages={},this._model.smLinkMap.forEach(function(a,c){b.chapters.set(a,new h(a));for(var d=0,e=c;d<e.length;d++){var f=e[d];b.pageChapterMap.has(f)||b.pageChapterMap.set(f,[]),b.pageChapterMap.get(f).push(a)}})}return a.prototype.hasLoadedPages=function(){return Object.keys(this._loadedPages).length>0},a.prototype.getAreaListOfChapter=function(a){var b=a.additional.get("blocklist");return null==b?[]:b.map(function(a){return new i(a.fileId,a.fromId,a.toId)})},a.prototype.getChapter=function(a){return this.findChapter(this._model.rootChapter,a)},a.prototype.findChapter=function(a,b){if(a.id==b)return a;for(var c=0,d=a.chapter;c<d.length;c++){var e=d[c],f=this.findChapter(e,b);if(null!=f)return f}return null},a.prototype.getBlocklistOfChapterAndAltoHref=function(a,b){var c=this.getChapter(a);return null==c?[]:this.getAreaListOfChapter(c).filter(function(a){return b===a.altoRef})},a.prototype.getAllBlocklistChapters=function(a){var b=this,c=[];return null!=a.additional.get("blocklist")&&c.push(a),a.chapter.forEach(function(a){c=c.concat(b.getAllBlocklistChapters(a))}),c},a.prototype.addPage=function(a,b,c){var d=this;null==this._loadedPages[a]&&(this._loadedPages[a]=!0,this.pageChapterMap.hasThen(a,function(e){e.map(function(a){return d.chapters.get(a)}).forEach(function(e){e.addPage(a,c,d.getBlocklistOfChapterAndAltoHref(e.chapterId,b))}),e.map(function(a){return d.chapters.get(a)}).forEach(function(b,d,e){var f=b.maximize(a);if(null!=f){b.boundingBoxMap.set(a,[f]);for(var g=0;g<e.length;g++)if(d!=g){var h=e[g].maximize(a);b.fixBoundingBox(a,h),b.fixIntersections(a,e[g])}var i=b.altoRectMap.get(a);b.cutVerticalBoundingBox(a,i[0].getY()),b.cutVerticalBoundingBox(a,i[i.length-1].getY()+i[i.length-1].getHeight()),b.fixEmptyAreas(a,c)}})}))},a}();b.AltoChapterContainer=g;var h=function(){function a(a){this.chapterId=a,this.boundingBoxMap=new MyCoReMap,this.altoRectMap=new MyCoReMap,this.metsAreas=new MyCoReMap}return a.prototype.addPage=function(a,b,c){var d=this.getAltoBlocks(b,c),e=this.getAreaRects(b,d);this.altoRectMap.set(a,e),this.boundingBoxMap.set(a,e),this.metsAreas.set(a,c)},a.prototype.maximize=function(a){var b=this.boundingBoxMap.get(a);return null==b||0==b.length?null:b.reduce(function(a,b){return a.maximizeRect(b)})},a.prototype.fixBoundingBox=function(a,b){if(null!=b)for(var c=this.boundingBoxMap.get(a),d=function(d){if(!d.intersectsArea(b)||e.intersectsText(a,b))return"continue";c=c.filter(function(a){return a!==d}),d.difference(b).forEach(function(a){return c.push(a)}),e.boundingBoxMap.set(a,c),e.fixBoundingBox(a,b)},e=this,f=0,g=c;f<g.length;f++){var h=g[f];d(h)}},a.prototype.intersectsText=function(a,b){for(var c=this.altoRectMap.get(a),d=0,e=c;d<e.length;d++){if(e[d].intersectsArea(b))return!0}return!1},a.prototype.fixIntersections=function(a,b){for(var c=this.boundingBoxMap.get(a),d=b.boundingBoxMap.get(a),e=function(e){for(var g=0,h=d;g<h.length;g++){var i=h[g];if(e.intersectsArea(i))return c=c.filter(function(a){return a!==e}),e.difference(i).forEach(function(a){return c.push(a)}),f.boundingBoxMap.set(a,c),f.fixIntersections(a,b),{value:void 0}}},f=this,g=0,h=c;g<h.length;g++){var i=h[g],j=e(i);if("object"==typeof j)return j.value}},a.prototype.cutVerticalBoundingBox=function(a,b){for(var c=this.boundingBoxMap.get(a),d=function(d){if(!d.intersectsVertical(b))return"continue";c=c.filter(function(a){return a!==d});var f=b-d.getY();c.push(Rect.fromXYWH(d.getX(),d.getY(),d.getWidth(),f)),c.push(Rect.fromXYWH(d.getX(),d.getY()+f+1,d.getWidth(),d.getHeight()-(f+1))),e.boundingBoxMap.set(a,c)},e=this,f=0,g=c;f<g.length;f++){var h=g[f];d(h)}},a.prototype.fixEmptyAreas=function(a,b){var c=this.boundingBoxMap.get(a),d=this.metsAreas.get(a),e=b.allElements.map(function(a){return a.getId()}),f=b.allElements.filter(function(a){return d.some(function(b){return b.contains(e,a.getId())})}).map(function(a){return a.asRect()});c=c.filter(function(a){for(var b=0,c=f;b<c.length;b++){var d=c[b];if(a.intersectsArea(d))return!0}return!1}),this.boundingBoxMap.set(a,c)},
a.prototype.getAltoBlocks=function(a,b){var c=a.allElements,d=c.map(function(a){return a.getId()}),e=[];return b.map(function(a){return[d.indexOf(a.begin),d.indexOf(a.end)]}).forEach(function(a){for(var b=a[0],d=a[1],f=b;f<=d;f++){var g=c[f];null!=g&&e.push(g)}}),e},a.prototype.getAreaRects=function(a,b){var c=Math.ceil(.004*a.pageHeight);return b.map(function(a){return Rect.fromXYWH(a.getBlockHPos(),a.getBlockVPos(),a.getWidth(),a.getHeight()).increase(c)})},a}();b.AltoChapter=h;var i=function(){function a(a,b,c){this.altoRef=a,this.begin=b,this.end=c}return a.prototype.contains=function(a,b){var c=a.indexOf(b);return c>=a.indexOf(this.begin)&&c<=a.indexOf(this.end)},a}();b.MetsArea=i}(a.components||(a.components={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReHighlightAltoComponent);var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function b(a,b){var c=this;this.i18n=b,this.idChangeMap=new MyCoReMap,this.fileChangeMap=new MyCoReMap,this.idViewMap=new MyCoReMap,this.changeClickHandler=new Array,this.changeRemoveClickHandler=new Array,this.submitClickHandler=new Array,this.applyClickHandler=new Array,this.deleteClickHandler=new Array,this.downArrow=jQuery("\n<span class='glyphicon glyphicon-arrow-down sortArrow'>\n</span> \n"),this.upArrow=jQuery("    \n<span class='glyphicon glyphicon-arrow-up sortArrow'>\n</span> \n"),this.widgetElement=jQuery(this.createHTML()),this.widgetElement.appendTo(a),this.tableContainer=this.widgetElement.find("tbody.table-line-container"),this.buttonContainer=this.widgetElement.find("div.button-group-container"),this.changeWordButton=this.widgetElement.find("button.changeWord"),this.submitButton=this.widgetElement.find(".submit-button"),this.applyButton=this.widgetElement.find(".apply-button"),this.deleteButton=this.widgetElement.find(".delete-button"),this.pageHeading=this.widgetElement.find("[data-sort=pageHeading]"),this.actionHeading=this.widgetElement.find("[data-sort=actionHeading]"),this.infoHeading=this.widgetElement.find("[data-sort=infoHeading]"),this.pageHeading.click(this.getSortClickEventHandler("pageHeading")),this.actionHeading.click(this.getSortClickEventHandler("actionHeading")),this.infoHeading.click(this.getSortClickEventHandler("infoHeading")),this.submitButton.click(function(){c.submitClickHandler.forEach(function(a){a()})}),this.applyButton.click(function(){c.applyClickHandler.forEach(function(a){a()})}),this.deleteButton.click(function(){c.deleteClickHandler.forEach(function(a){a()})})}return b.prototype.enableApplyButton=function(a){void 0===a&&(a=!0),a?this.applyButton.show():this.applyButton.hide()},b.prototype.addChangeClickedEventHandler=function(a){this.changeClickHandler.push(a)},b.prototype.addSubmitClickHandler=function(a){this.submitClickHandler.push(a)},b.prototype.addApplyClickHandler=function(a){this.applyClickHandler.push(a)},b.prototype.addDeleteClickHandler=function(a){this.deleteClickHandler.push(a)},b.prototype.addChangeRemoveClickHandler=function(a){this.changeRemoveClickHandler.push(a)},b.prototype.getSortClickEventHandler=function(a){var b=this;return function(c){var d=b.getCurrentSortMethod();null==d||d.sortBy!==a?b.sortBy(a,!0):b.sortBy(a,!d.down)}},b.prototype.getCurrentSortMethod=function(){var a,b;if((a=(b=this.downArrow).parent()).length>0||(a=(b=this.upArrow).parent()).length>0){return{sortBy:a.attr("data-sort"),down:b[0]===this.downArrow[0]}}return null},b.prototype.sortBy=function(a,b){var c=this;this.downArrow.detach(),this.upArrow.detach();var d=this.widgetElement.find("[data-sort="+a+"]");b?d.append(this.downArrow):d.append(this.upArrow);var e=[];this.idViewMap.forEach(function(a,b){b.detach(),e.push(b)}),e.sort(this.getSortFn(a,b)).forEach(function(a){c.tableContainer.append(a)})},b.prototype.getSortFn=function(a,b){var c=this,d=["action","pageHeading","actionHeading","infoHeading"];switch(a){case d[1]:return function(a,d){var e=c.idChangeMap.get(a.attr("data-id")).pageOrder,f=c.idChangeMap.get(d.attr("data-id")).pageOrder;return(b?1:-1)*(e-f)};case d[2]:case d[3]:return function(c,e){var f=jQuery(c.children("td").get(d.indexOf(a))).text(),g=jQuery(e.children("td").get(d.indexOf(a))).text();return(b?1:-1)*f.localeCompare(g)}}return function(a,b){return-1}},b.prototype.createHTML=function(){return'\n<div class="alto-editor-widget container-fluid">\n    <h3 class="small-heading">'+this.getLabel("altoWidget.heading")+'</h3>     \n    <div class="btn-toolbar edit">\n        <div class="btn-group btn-group-xs button-group-container">\n            <button type="button" class="btn btn-default changeWord">'+this.getLabel("altoWidget.changeWord")+'</button>\n        </div>\n    </div>\n    <h3 class="small-heading">'+this.getLabel("altoWidget.changesHeading")+'</h3>\n    <div class="table-responsive">\n        <table class="table table-condensed">\n            <thead>\n                <tr>\n                    <th></th>\n                    <th data-sort="pageHeading">'+this.getLabel("altoWidget.table.page")+'</th>\n                    <th data-sort="actionHeading">'+this.getLabel("altoWidget.table.action")+'</th>\n                    <th data-sort="infoHeading">'+this.getLabel("altoWidget.table.info")+'</th>\n                </tr>\n            </thead>\n            <tbody class="table-line-container">\n                \n            </tbody>\n        </table>\n    </div>\n    <div class="btn-toolbar action">\n        <div class="btn-group btn-group-xs button-group-container">\n            <button type="button" class="btn btn-primary apply-button">'+this.getLabel("altoWidget.apply")+'</button>\n            <button type="button" class="btn btn-success submit-button">'+this.getLabel("altoWidget.submit")+'</button>\n            <button type="button" class="btn btn-danger delete-button">'+this.getLabel("altoWidget.delete")+"</button>\n        </div>\n    </div>\n</div>\n"},b.prototype.getLabel=function(a){return this.i18n.getTranslation(a)},b.prototype.hasChange=function(a){return this.idChangeMap.has(a)},b.prototype.getChange=function(a){return this.idChangeMap.get(a)},b.prototype.getChanges=function(){return this.idChangeMap},b.prototype.getChangesInFile=function(a){return this.fileChangeMap.get(a)||[]},b.prototype.addChange=function(a,b){if(-1==this.idChangeMap.values.indexOf(b)){this.idChangeMap.set(a,b);var c=this.fileChangeMap.get(b.file);this.fileChangeMap.has(b.file)||(c=[],this.fileChangeMap.set(b.file,c)),c.push(b),this.addRow(a,b)}},b.prototype.addRow=function(a,b){var c=this,d=jQuery('\n<tr data-id="'+a+'">\n    '+this.getChangeHTMLContent(b)+"\n</tr>\n"),e=this.getCurrentSortMethod();if(null!=e){var f=this.getSortFn(e.sortBy,e.down),g=!1;this.tableContainer.children("tr").each(function(a,b){var c=jQuery(b);g||-1!=f(d,c)||(d.insertBefore(c),g=!0)}),g||this.tableContainer.append(d)}else this.tableContainer.append(d);d.click(function(a){jQuery(a.target).hasClass("remove")?c.changeRemoveClickHandler.forEach(function(a){a(b)}):c.changeClickHandler.forEach(function(a){a(b)})}),this.idViewMap.set(a,d)},b.prototype.getChangeText=function(b){if(b.type==a.AltoWordChange.TYPE){var c=b;return c.from+" => "+c.to}},b.prototype.updateChange=function(a){var b=this.getChangeID(a);this.idViewMap.get(b).html(this.getChangeHTMLContent(a))},b.prototype.getChangeID=function(a){var b=null;return this.idChangeMap.forEach(function(c,d){d==a&&(b=c)}),b},b.prototype.getChangeHTMLContent=function(a){return'\n<td><span class="glyphicon glyphicon-remove remove"></span></td>\n<td>'+a.pageOrder+"</td>\n<td>"+this.i18n.getTranslation("altoWidget.change."+a.type)+"</td>\n<td>"+this.getChangeText(a)+"</td>\n"},b.prototype.removeChange=function(a){var b=this.getChangeID(a);if(this.idViewMap.get(b).remove(),this.idViewMap.remove(b),this.idChangeMap.remove(b),this.fileChangeMap.has(a.file))for(var c=this.fileChangeMap.get(a.file),d=0;-1!=(d=c.indexOf(a,d));)c.splice(d,1)},b}();a.AltoEditorWidget=b}(a.alto||(a.alto={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(b){!function(c){var d=a.viewer.components.events.WaitForEvent,e=a.viewer.components.events.ShowContentEvent,f=a.viewer.widgets.alto.AltoEditorWidget,g=a.viewer.widgets.alto.AltoWordChange,h=a.viewer.widgets.canvas.DesktopInputAdapter,i=a.viewer.components.events.PageLoadedEvent,j=function(h){function j(a,b){h.call(this),this._settings=a,this._container=b,this.highlightWordLayer=new l(this),this.altoIDImageMap=new MyCoReMap,this.imageHrefAltoContentMap=new MyCoReMap,this.altoHrefImageHrefMap=new MyCoReMap,this.imageHrefAltoHrefMap=new MyCoReMap,this.initialHtmlApplyList=new Array,this.everythingLoadedSynchronize=Utils.synchronize([function(a){return null!=a._toolbarModel},function(a){return null!=a._languageModel},function(a){return null!=a._structureModel},function(a){return a._altoPresent}],function(a){a.completeLoaded()}),this.currentEditWord=null,this.beforeEditWord=null}return __extends(j,h),j.prototype.init=function(){var a=this;this.editorEnabled()&&(this.container=jQuery("<div></div>"),this.containerTitle=jQuery("<span>ALTO-Editor</span>"),this.trigger(new d(this,c.events.ProvideToolbarModelEvent.TYPE)),this.container.bind("iviewResize",function(){a.updateContainerSize()}))},j.prototype.editorEnabled=function(){return void 0!==this._settings.altoEditorPostURL&&null!=this._settings.altoEditorPostURL},j.prototype.handle=function(a){var d=this;if(a.type==c.events.StructureModelLoadedEvent.TYPE){var e=a;this._structureModel=e.structureModel,this._structureImages=this._structureModel.imageList;for(var f in this._structureImages){var g=this._structureImages[f],h=g.additionalHrefs.get("AltoHref");if(this._altoPresent=this._altoPresent||null!=h,this._altoPresent){if(null==h){console.warn("there is no alto.xml for "+g.href);continue}this.altoHrefImageHrefMap.set(h,g.href)}}this.everythingLoadedSynchronize(this)}if(a.type==c.events.LanguageModelLoadedEvent.TYPE){var i=a;this._languageModel=i.languageModel,this.everythingLoadedSynchronize(this)}if(a.type==c.events.ProvideToolbarModelEvent.TYPE){var k=a;this._toolbarModel=k.model,this._sidebarControllDropdownButton=k.model._sidebarControllDropdownButton,this.everythingLoadedSynchronize(this)}if(a.type==b.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE){a.childId===j.DROP_DOWN_CHILD_ID&&this.openEditor()}if(a.type==c.events.PageLoadedEvent.TYPE){var l=a,m=l.abstractPage.getHTMLContent();null!=m.value?this.updateHTML(l.abstractPage.id,m.value):m.addObserver({propertyChanged:function(a,b){d.updateHTML(l.abstractPage.id,b.value)}})}if(a.type==c.events.ShowContentEvent.TYPE){var n=a;n.containerDirection==c.events.ShowContentEvent.DIRECTION_WEST&&0==n.size&&this.toggleEditWord(!1)}if(a.type==c.events.RequestStateEvent.TYPE){var o=a;"altoChangePID"in this._settings&&null!=this._settings.altoChangePID&&o.stateMap.set("altoChangeID",this._settings.altoChangePID)}},j.prototype.openEditor=function(){this.trigger(new e(this,this.container,e.DIRECTION_WEST,400,this.containerTitle))},j.prototype.updateHTML=function(a,b){var c=this._structureModel.imageHrefImageMap.get(a),d=c.additionalHrefs.get("AltoHref");this.altoIDImageMap.set(b.getAttribute("data-id"),c),this.imageHrefAltoContentMap.set(c.href,b),this.imageHrefAltoHrefMap.set(c.href,d),this.syncChanges(b,d),this.isEditing()?this.applyConfidenceLevel(b):this.removeConfidenceLevel(b)},j.prototype.mouseClick=function(a,b){if(this.isEditing()){var c=b.target,d=parseInt(c.getAttribute("data-vpos")),e=parseInt(c.getAttribute("data-hpos")),f=parseInt(c.getAttribute("data-width")),g=parseInt(c.getAttribute("data-height"));if(!isNaN(d)&&!isNaN(e)){if(this.currentEditWord!==c){this.editWord(c,d,e,f,g);var h=document.createRange();h.selectNodeContents(this.currentEditWord);var i=window.getSelection();i.removeAllRanges(),i.addRange(h)}return}}b.preventDefault()},j.prototype.editWord=function(a,b,d,e,f){null!=this.currentEditWord&&this.applyEdit(this.currentEditWord,this.currentAltoID,this.currentOrder);var g=function(a){return null==a.getAttribute("data-id")?g(a.parentElement):a.getAttribute("data-id")},h=g(a);this.currentAltoID=h,this.currentOrder=this.altoIDImageMap.get(h).order,this.currentEditWord=a,this.beforeEditWord=a.innerText,this.currentEditWord.setAttribute("contenteditable","true"),this.highlightWordLayer.setHighlightedWord({vpos:b,hpos:d,width:e,height:f,id:this.currentAltoID}),this.trigger(new c.events.RedrawEvent(this))},j.prototype.keyDown=function(a){if(null!=this.currentEditWord){if(a.keyCode==j.ENTER_KEY)return void this.applyEdit(this.currentEditWord,this.currentAltoID,this.currentOrder);if(a.keyCode==j.ESC_KEY)return void this.abortEdit(this.currentEditWord)}},j.prototype.abortEdit=function(a){a.innerText=this.beforeEditWord,this.endEdit(a)},j.prototype.resetWordEdit=function(a){this.currentEditWord==a&&this.abortEdit(a),a.innerText=a.getAttribute("data-word"),a.classList.contains("edited")&&a.classList.remove("edited")},j.prototype.applyEdit=function(a,b,c){var d=parseInt(a.getAttribute("data-vpos")),e=parseInt(a.getAttribute("data-hpos")),f=parseInt(a.getAttribute("data-width")),h=parseInt(a.getAttribute("data-height")),i=a.innerHTML,j=this.calculateChangeKey(b,d,e),k=a.getAttribute("data-word");if(this.editorWidget.hasChange(j)){var l=this.editorWidget.getChange(j);k!==i?(l.to=i,this.editorWidget.updateChange(l)):(this.editorWidget.removeChange(l),a.classList.contains("edited")&&a.classList.remove("edited"))}else if(k!==i){var l=new g(b,e,d,f,h,k,i,c);this.editorWidget.addChange(j,l),a.classList.add("edited")}this.endEdit(a)},j.prototype.calculateChangeKey=function(a,b,c){return a+"_"+b+"_"+c},j.prototype.endEdit=function(a){this.currentEditWord=this.currentOrder=this.currentAltoID=this.beforeEditWord=null,a.setAttribute("contenteditable","false"),this.highlightWordLayer.setHighlightedWord(null),viewerClearTextSelection(),this.trigger(new c.events.RedrawEvent(this))},Object.defineProperty(j.prototype,"handlesEvents",{get:function(){return this.editorEnabled()?[c.events.StructureModelLoadedEvent.TYPE,c.events.LanguageModelLoadedEvent.TYPE,c.events.ProvideToolbarModelEvent.TYPE,b.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE,c.events.ImageChangedEvent.TYPE,c.events.PageLoadedEvent.TYPE,c.events.ShowContentEvent.TYPE,c.events.RequestStateEvent.TYPE]:[]},enumerable:!0,configurable:!0}),j.prototype.toggleEditWord=function(a){var b=this;if(void 0===a&&(a=null),null!=this.editorWidget){a=null==a?!this.editorWidget.changeWordButton.hasClass("active"):a;var d=this.editorWidget.changeWordButton;a?(d.addClass("active"),this.imageHrefAltoContentMap.values.forEach(function(a){b.applyConfidenceLevel(a)})):(d.removeClass("active"),null!=this.currentEditWord&&this.endEdit(this.currentEditWord),this.imageHrefAltoContentMap.values.forEach(function(a){b.removeConfidenceLevel(a)})),this.trigger(new c.events.TextEditEvent(this,a)),this.trigger(new c.events.RedrawEvent(this))}},j.prototype.isEditing=function(){return null!=this.editorWidget&&this.editorWidget.changeWordButton.hasClass("active")},j.prototype.completeLoaded=function(){var b=this;this._altoDropdownChildItem={id:j.DROP_DOWN_CHILD_ID,label:this._languageModel.getTranslation("altoEditor")},this._sidebarControllDropdownButton.children.push(this._altoDropdownChildItem),this._sidebarControllDropdownButton.children=this._sidebarControllDropdownButton.children,this.editorWidget=new f(this.container,this._languageModel),this.containerTitle.text(""+this._languageModel.getTranslation("altoEditor")),void 0!==this._settings.altoReviewer&&null!=this._settings.altoReviewer&&this._settings.altoReviewer&&this.editorWidget.enableApplyButton(!0),void 0!==this._settings.altoChanges&&null!=this._settings.altoChanges&&"wordChanges"in this._settings.altoChanges&&this._settings.altoChanges.wordChanges instanceof Array&&this._settings.altoChanges.wordChanges.forEach(function(a){a.pageOrder=b._structureModel.imageHrefImageMap.get(b.altoHrefImageHrefMap.get(a.file)).order,b.editorWidget.addChange(b.calculateChangeKey(a.file,a.hpos,a.vpos),a),b.initialHtmlApplyList.push(a)}),this.editorWidget.changeWordButton.click(function(a){b.toggleEditWord()}),this.editorWidget.addChangeClickedEventHandler(function(a){b.trigger(new c.events.ImageSelectedEvent(b,b._structureModel.imageHrefImageMap.get(b.altoHrefImageHrefMap.get(a.file))))});var d=function(c){b._settings.altoChangePID=c.pid,new a.viewer.widgets.modal.ViewerInfoModal(b._settings.mobile,"altoChanges.save.successful.title","altoChanges.save.successful.message").updateI18n(b._languageModel).show()},e=function(){b._settings.altoChangePID=null,b.trigger(new c.events.UpdateURLEvent(b)),window.location.reload(!0)},g=function(c){console.log(c);var d=b._settings.webApplicationBaseURL+"/modules/iview2/img/sad-emotion-egg.jpg";new a.viewer.widgets.modal.ViewerErrorModal(b._settings.mobile,"altoChanges.save.failed.title","altoChanges.save.failed.message",d).updateI18n(b._languageModel).show()},h=function(c){console.log(c);var d=b._settings.webApplicationBaseURL+"/modules/iview2/img/sad-emotion-egg.jpg";new a.viewer.widgets.modal.ViewerErrorModal(b._settings.mobile,"altoChanges.delete.failed.title","altoChanges.delete.failed.message",d).updateI18n(b._languageModel).show()};this.editorWidget.addSubmitClickHandler(function(){b.submitChanges(d,g)}),this.editorWidget.addApplyClickHandler(function(){new a.viewer.widgets.modal.ViewerConfirmModal(b._settings.mobile,"altoChanges.applyChanges.title","altoChanges.applyChanges.message",function(a){a&&b.submitChanges(function(a){b._settings.altoChangePID=a.pid,b.applyChanges(e,g)},g)}).updateI18n(b._languageModel).show()}),this.editorWidget.addDeleteClickHandler(function(){new a.viewer.widgets.modal.ViewerConfirmModal(b._settings.mobile,"altoChanges.removeChanges.title","altoChanges.removeChanges.message",function(a){if(b._settings.altoChangePID){var d=b._settings.altoEditorPostURL;d+="/delete/"+b._settings.altoChangePID,jQuery.ajax(d,{contentType:"application/json",type:"POST",success:function(){b._settings.altoChangePID=null,b.trigger(new c.events.UpdateURLEvent(b))},error:h})}b.editorWidget.getChanges().forEach(function(a,c){b.removeChange(c)})}).updateI18n(b._languageModel).show()}),this.editorWidget.addChangeRemoveClickHandler(function(c){new a.viewer.widgets.modal.ViewerConfirmModal(b._settings.mobile,"altoChanges.removeChange.title","altoChanges.removeChange.message",function(a){a&&b.removeChange(c)}).updateI18n(b._languageModel).show()}),this.trigger(new c.events.AddCanvasPageLayerEvent(this,2,this.highlightWordLayer)),this.trigger(new c.events.RequestDesktopInputEvent(this,new k(this))),this.trigger(new c.events.WaitForEvent(this,i.TYPE)),"altoEditor"===this._settings.leftShowOnStart&&this.openEditor(),this.updateContainerSize()},j.prototype.removeChange=function(a){this.editorWidget.removeChange(a);var b=this.altoHrefImageHrefMap.get(a.file);if(this.imageHrefAltoContentMap.has(b)){var d=this.imageHrefAltoContentMap.get(b);if(a.type===g.TYPE){var e=a,f=this.findChange(e,d);0==f.length?console.log("Could not find change "+e):this.resetWordEdit(f.get(0))}}this.trigger(new c.events.RedrawEvent(this))},j.prototype.applyChanges=function(a,b){var c=this._settings.altoEditorPostURL;c+="/apply/"+this._settings.altoChangePID,jQuery.ajax(c,{contentType:"application/json",type:"POST"}).done(a).fail(b)},j.prototype.submitChanges=function(a,b){var c={wordChanges:this.editorWidget.getChanges().values,derivateID:this._settings.derivate},d=this._settings.altoEditorPostURL;void 0!==this._settings.altoChangePID&&null!=this._settings.altoChangePID?d+="/update/"+this._settings.altoChangePID:d+="/store",jQuery.ajax(d,{data:this.prepareData(c),contentType:"application/json",type:"POST"}).done(a).fail(b)},j.prototype.prepareData=function(a){var b=JSON.parse(JSON.stringify(a));return b.wordChanges.forEach(function(a){"pageOrder"in a&&delete a.pageOrder}),JSON.stringify(b)},j.prototype.findChange=function(a,b){var c="[data-hpos="+a.hpos+"][data-vpos="+a.vpos+"][data-width="+a.width+"][data-height="+a.height+"]";return jQuery(b).find(c)},j.prototype.updateContainerSize=function(){this.container.css({height:this.container.parent().height()-this.containerTitle.parent().outerHeight()+"px","overflow-y":"scroll"})},j.prototype.drag=function(a,b,c,d){d.target!==this.currentEditWord&&d.preventDefault()},j.prototype.mouseDown=function(a,b){b.target!==this.currentEditWord&&b.preventDefault()},j.prototype.syncChanges=function(a,b){var c=this;this.editorWidget.getChangesInFile(b).forEach(function(b){if(b.type==g.TYPE){var d=b,e=c.findChange(d,a);e.length>0?(e[0].innerText=d.to,e.addClass("edited")):console.log("Could not find Change: "+b)}})},j.prototype.applyConfidenceLevel=function(a){jQuery(a).find("[data-wc]:not([data-wc='1'])").each(function(a,b){var c=jQuery(b);parseFloat(c.attr("data-wc"))<.9&&c.addClass("unconfident")})},j.prototype.removeConfidenceLevel=function(a){jQuery(a).find(".unconfident").removeClass("unconfident")},j.DROP_DOWN_CHILD_ID="altoButtonChild",j.ENTER_KEY=13,j.ESC_KEY=27,j}(c.ViewerComponent);c.MyCoReAltoEditorComponent=j;var k=function(a){function b(b){a.call(this),this.editAltoComponent=b}return __extends(b,a),b.prototype.mouseDown=function(a,b){this.editAltoComponent.isEditing()&&this.editAltoComponent.mouseDown(a,b)},b.prototype.mouseUp=function(a,b){},b.prototype.mouseMove=function(a,b){},b.prototype.mouseClick=function(a,b){this.editAltoComponent.isEditing()&&this.editAltoComponent.mouseClick(a,b)},b.prototype.mouseDoubleClick=function(a,b){},b.prototype.keydown=function(a){this.editAltoComponent.keyDown(a)},b.prototype.mouseDrag=function(a,b,c,d){this.editAltoComponent.isEditing()&&this.editAltoComponent.drag(a,b,c,d)},b}(h);c.EditAltoInputListener=k;var l=function(){function a(a){this.component=a,this.highlightedWord=null}return a.prototype.getHighlightedWord=function(){return this.highlightedWord},a.prototype.setHighlightedWord=function(a){this.highlightedWord=a},a.prototype.draw=function(b,c,d,e){var f=this;if(!e){b.save(),null!=this.highlightedWord&&c==this.component.altoHrefImageHrefMap.get(this.highlightedWord.id)&&this.strokeWord(b,this.highlightedWord.hpos,this.highlightedWord.vpos,this.highlightedWord.width,this.highlightedWord.height,a.EDIT_HIGHLIGHT_COLOR);var h=this.component.imageHrefAltoHrefMap.get(c);void 0!==h&&this.component.editorWidget.getChangesInFile(h).forEach(function(c){if(c.type==g.TYPE){var d=c;f.strokeWord(b,d.hpos,d.vpos,d.width,d.height,a.EDITED_HIGHLIGHT_COLOR)}}),b.restore()}},a.prototype.strokeWord=function(a,b,c,d,e,f){var g=5*window.devicePixelRatio,h=g/2+5*devicePixelRatio;a.rect(b-h,c-h,d+2*h,e+2*h),a.strokeStyle=f,a.lineWidth=g,a.stroke()},a.EDIT_HIGHLIGHT_COLOR="#90EE90",a.EDITED_HIGHLIGHT_COLOR="#ADD8E6",a}();c.HighligtAltoWordCanvasPageLayer=l}(b.components||(b.components={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReAltoEditorComponent),console.log("METS MODULE");