var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},mycore;!function(a){!function(a){!function(b){!function(b){var c=function(a){function b(b,c,d,e,f,g){a.call(this,b,c,d,e,f,!0),this.refPageMap=g}return __extends(b,a),b}(a.model.StructureModel);b.PDFStructureModel=c}(b.pdf||(b.pdf={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(b){!function(b){var c=function(){function c(a,b){this._document=a,this._name=b,this._structureModel=null,this._chapterPageMap=new MyCoReMap,this._pages=new Array,this._pageCount=0,this._refPageMap=new MyCoReMap,this._idPageMap=new MyCoReMap,this._promise=new ViewerPromise,this._outlineTodoCount=0,this._pageCount=this._document.numPages}return c.prototype.resolve=function(){return this._resolvePages(),this._resolveOutline(),this._promise},c.prototype._resolvePages=function(){var b=this;this._loadedPageCount=0;for(var d=1;d<=b._pageCount;d++){var e=this._createThumbnailDrawer(d),f=new MyCoReMap;f.set(c.PDF_TEXT_HREF,d+"");var g=new a.model.StructureImage("pdfPage",d+"",d,null,d+"","pdfPage",e,f);b._pages.push(g),b._idPageMap.set(d,g)}},c.prototype._createThumbnailDrawer=function(a){var b=this,c=null,d=new Array;return function(e){null==c?(d.push(function(a){null==c&&(c=a),e(a)}),1==d.length&&b._document.getPage(a).then(function(a){b._renderPage(d,a)})):e(c)}},c.prototype._renderPage=function(a,b){var c=this,d=new Size2D(b.view[2]-b.view[0],b.view[3]-b.view[1]),e=Math.max(d.width,d.height),f=256/e,g=b.getViewport(f),h=document.createElement("canvas"),i=h.getContext("2d");h.width=d.width*f,h.height=d.height*f,b.render({canvasContext:i,viewport:g}).promise.then(function(b){c._loadedPageCount++;var d=h.toDataURL();h=null,i=null;for(var e in a)(0,a[e])(d)})},c.prototype._resolveOutline=function(){var a=this;this._document.getOutline().then(function(b){a._outline=b,a.resolveStructure()})},c.prototype.getPageNumberFromDestination=function(a,b){var c,d=this;c="string"==typeof a?this._document.getDestination(a):window.Promise.resolve(a),c.then(function(a){if(!(a instanceof Array))return void console.error("Invalid destination "+a);d._document.getPageIndex(a[0]).then(function(a){void 0!==a&&null!=a&&(a>d._pageCount?console.error("Destination outside of Document! ("+a+")"):b(a+1))})})},c.prototype.getChapterFromOutline=function(b,c,d){var e=this,f=new Array;for(var g in c){var h=c[g],i=function(a){return function(b){e.getPageNumberFromDestination(a.dest,b)}}(h),j=new a.model.StructureChapter(b,"pdfChapter",Utils.hash(h.title+d++).toString(),h.title,null,null,i),k=this.getChapterFromOutline(j,h.items,d++);j.chapter=k,f.push(j)}return f},c.prototype.checkResolvable=function(){null!=this._structureModel&&0==this._outlineTodoCount&&this._promise.resolve(this._structureModel)},c.prototype.resolveStructure=function(){if(void 0!==this._outline){this._rootChapter=new a.model.StructureChapter(null,"pdf","0",this._name,null,null,function(){return 1}),this._rootChapter.chapter=this.getChapterFromOutline(this._rootChapter,this._outline,1),this._structureModel=new b.PDFStructureModel(this._rootChapter,this._pages,this._chapterPageMap,new MyCoReMap,new MyCoReMap,this._refPageMap),this.checkResolvable()}},c.destToString=function(a){return a.gen+" "+a.num},c.PDF_TEXT_HREF="pdfText",c}();b.PDFStructureBuilder=c}(b.pdf||(b.pdf={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(b,c,d){this.id=b,this.pdfPage=c,this.builder=d,this._frontBuffer=document.createElement("canvas"),this._backBuffer=document.createElement("canvas"),this._timeOutIDHolder=null,this._bbScale=-1,this._fbScale=-1,this._promiseRunning=!1,this._textData=null;var e=(this.pdfPage.view[2]-this.pdfPage.view[0])*a.CSS_UNITS,f=(this.pdfPage.view[3]-this.pdfPage.view[1])*a.CSS_UNITS,g=c.pageInfo.rotate;90!=g&&270!=g||(e^=f,f^=e,e^=f),this._rotation=g,this.size=new Size2D(e,f)}return a.prototype.resolveTextContent=function(b){var d=this;if(null==this._textData){var e={content:[],links:[],internLinks:[]};this._textData=e;var f=!1,g=!1,h=function(){return f&&g?b(e):null};this.pdfPage.getAnnotations().then(function(a){if(g=!0,a.length>0)for(var b=0,c=a;b<c.length;b++){var f=c[b];if(2==f.annotationType&&"Link"==f.subtype)if("url"in f)e.links.push({rect:d.getRectFromAnnotation(f),url:f.url});else if("dest"in f){var i=function(a){return function(b){d.builder.getPageNumberFromDestination(a.dest,function(a){b(a+"")})}}(f);e.internLinks.push({rect:d.getRectFromAnnotation(f),pageNumberResolver:i})}}h()}),this.pdfPage.getTextContent().then(function(b){f=!0,b.items.forEach(function(f){var g=d.pdfPage.getViewport(1),h=PDFJS.Util.transform(g.transform,f.transform),i=b.styles[f.fontName],j=Math.atan2(h[1],h[0])+(1==i.vertical?Math.PI/2:0),k=Math.sqrt(h[2]*h[2]+h[3]*h[3]),l=k;i.ascent?l=i.ascent*l:i.descent&&(l=(1+i.descent)*l);var m,n;m=h[4]*a.CSS_UNITS,n=h[5]*a.CSS_UNITS;var o=new c(j,new Size2D(f.width,f.height).scale(a.CSS_UNITS).roundDown(),k,f.str,new Position2D(m,n),i.fontFamily,d.id);e.content.push(o)}),h()},function(a){f=!0,console.error("PDF Page Text Content rejected"),console.error("Reason: "+a),h()})}else b(this._textData)},a.prototype.getRectFromAnnotation=function(b){return new Rect(new Position2D(b.rect[0]*a.CSS_UNITS,this.size.height-b.rect[1]*a.CSS_UNITS-(b.rect[3]-b.rect[1])*a.CSS_UNITS),new Size2D((b.rect[2]-b.rect[0])*a.CSS_UNITS,(b.rect[3]-b.rect[1])*a.CSS_UNITS))},a.prototype.draw=function(a,b,c,d,e){if(d||c==this._fbScale||this._promiseRunning||this._updateBackBuffer(c),-1!=this._fbScale){var f=b.scale(this._fbScale),g=b.scale(c),h=f.size.width,i=f.size.height;h>0&&i>0&&(a.save(),a.drawImage(this._frontBuffer,f.pos.x,f.pos.y,Math.min(h,this._frontBuffer.width),Math.min(i,this._frontBuffer.height),0,0,g.size.width,g.size.height),a.restore())}},a.prototype._updateBackBuffer=function(b){var c=this,d=this.pdfPage.getViewport(b*a.CSS_UNITS,this._rotation),e=this.pdfPage.render({canvasContext:this._backBuffer.getContext("2d"),viewport:d});this._bbScale=b,this._promiseRunning=!0,this._backBuffer.width=this.size.width*b,this._backBuffer.height=this.size.height*b;var f=function(a){c._promiseRunning=!1,c._swapBuffers(),c.refreshCallback()},g=function(a){console.log("Render Error",a)};e.promise.then(f,g)},a.prototype._swapBuffers=function(){var a=null;a=this._backBuffer,this._backBuffer=this._frontBuffer,this._frontBuffer=a,a=this._bbScale,this._bbScale=this._fbScale,this._fbScale=a},a.prototype.toString=function(){return this.pdfPage.pageNumber},a.prototype.clear=function(){this._frontBuffer.width=this._backBuffer.width=1,this._frontBuffer.width=this._backBuffer.width=1,this._bbScale=-1,this._fbScale=-1,this._promiseRunning=!1},a.CSS_UNITS=96/72,a}();a.PDFPage=b;var c=function(){function a(a,b,c,d,e,f,g){this.angle=a,this.size=b,this.fontSize=c,this.text=d,this.fontFamily=f,this.pageHref=g,this.fromBottomLeft=!1,this.pos=new Position2D(e.x,e.y-c)}return a.prototype.toString=function(){return this.pageHref.toString+"-"+this.pos.toString()+"-"+this.text.toString()+"-"+this.angle.toString()},a}()}(a.canvas||(a.canvas={}))}(a.widgets||(a.widgets={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={}));var mycore;!function(a){!function(b){!function(c){var d=function(d){function e(b,c){var e=this;d.call(this),this._settings=b,this.container=c,this._structure=null,this._pageCache=new MyCoReMap,this._errorModalSynchronize=Utils.synchronize([function(a){return null!=a._languageModel&&a.error}],function(b){var c=b._languageModel.getFormatedTranslation("noPDF","<a href='mailto:"+e._settings.adminMail+"'>"+e._settings.adminMail+"</a>"),d=b._languageModel.getTranslation("noPDFShort");new a.viewer.widgets.modal.ViewerErrorModal(e._settings.mobile,d,c,e._settings.webApplicationBaseURL+"/modules/iview2/img/sad-emotion-egg.jpg",e.container[0]).show(),b.trigger(new a.viewer.components.events.ShowContentEvent(e,jQuery(),a.viewer.widgets.layout.IviewBorderLayout.DIRECTION_WEST,0))}),this.error=!1,this.toolbarLanguageSync=Utils.synchronize([function(a){return null!=a._toolbarModel},function(a){return null!=a._languageModel}],function(a){a.addDownloadButton()}),this._toolbarModel=null,this._languageModel=null;PDFJS.disableAutoFetch=!0}return __extends(e,d),e.prototype.init=function(){var b=this;if("pdf"==this._settings.doctype){this._pdfUrl=ViewerFormatString(this._settings.pdfProviderURL,{filePath:this._settings.filePath,derivate:this._settings.derivate});var d=this._settings.pdfWorkerURL;PDFJS.workerSrc=d;var e=this,f=this._pdfUrl;PDFJS.getDocument(f).then(function(d){b._pdfDocument=d,e._structureBuilder=new a.viewer.widgets.pdf.PDFStructureBuilder(e._pdfDocument,b._settings.filePath);var f=e._structureBuilder.resolve();f.then(function(a){e._structure=a;var b=new c.events.StructureModelLoadedEvent(e,e._structure);e._structureModelLoadedEvent=b,e._pageCount=a._imageList.length,e.trigger(b)}),f.onreject(function(a){b.error=!0,b._errorModalSynchronize(b)})},function(a){console.log("error")}),this.trigger(new c.events.WaitForEvent(this,c.events.ProvideToolbarModelEvent.TYPE)),this.trigger(new c.events.WaitForEvent(this,c.events.LanguageModelLoadedEvent.TYPE))}},e.prototype.handle=function(a){var d=this;if(a.type==c.events.RequestPageEvent.TYPE){var e=a,f=e._pageId;if(this._pageCache.has(Number(f)))e._onResolve(f,this._pageCache.get(Number(f)));else{this._pdfDocument.getPage(Number(f)).then(function(a){var c=new b.widgets.canvas.PDFPage(e._pageId,a,d._structureBuilder);d._pageCache.set(Number(e._pageId),c),e._onResolve(e._pageId,c)},function(a){console.error("PDF Page Request rejected"),console.error("Reason: "+a)})}}if(a.type==c.events.RequestTextContentEvent.TYPE){var g=a;this.handle(new c.events.RequestPageEvent(this,g._href,function(a,b){b.resolveTextContent(function(a){g._onResolve(g._href,a)})}))}if(a.type==c.events.ProvideToolbarModelEvent.TYPE){var h=a;this._toolbarModel=h.model,this.toolbarLanguageSync(this)}if(a.type==c.events.LanguageModelLoadedEvent.TYPE){var i=a;this._languageModel=i.languageModel,this.toolbarLanguageSync(this),this._errorModalSynchronize(this)}if(a.type==b.widgets.toolbar.events.ButtonPressedEvent.TYPE){"PdfDownloadButton"==a.button.id&&window.location.assign(this._pdfUrl+"?dl")}},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){return"pdf"==this._settings.doctype?[c.events.RequestPageEvent.TYPE,c.events.ProvideToolbarModelEvent.TYPE,c.events.LanguageModelLoadedEvent.TYPE,b.widgets.toolbar.events.ButtonPressedEvent.TYPE,c.events.RequestTextContentEvent.TYPE]:[]},enumerable:!0,configurable:!0}),e.prototype.addDownloadButton=function(){this._toolbarModel._actionControllGroup.addComponent(new a.viewer.widgets.toolbar.ToolbarButton("PdfDownloadButton","",this._languageModel.getTranslation("toolbar.pdfDownload"),"download"))},e}(c.ViewerComponent);c.MyCoRePDFViewerComponent=d}(b.components||(b.components={}))}(a.viewer||(a.viewer={}))}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoRePDFViewerComponent),console.log("PDF MODULE");